import{j as e}from"./ui-vendor-S1POobSh.js";import{u as F,r as i,L as p}from"./react-vendor-DrHQLvTy.js";import{c as T,i as D,M as I,j as L,k as Q,d as A,O as j,Q as f,l as B,I as K,B as u,a as P,m as d}from"./index-B_z83aGI.js";import{A as G}from"./AuthLayout-DxpTxSLH.js";import{s as O,a as b}from"./authService-guulQlN8.js";import{C as y}from"./circle-check-big-DJfGvp7v.js";import"./chart-vendor-Bfyd95vO.js";import"./supabase-vendor-C-7U-qZP.js";import"./form-vendor-CeA2iSy3.js";import"./shield-CnI5vR7_.js";import"./users-B4TySy3P.js";import"./arrow-left-Bup_IKS6.js";const Z=()=>{F();const[s,x]=i.useState({email:""}),[l,a]=i.useState({}),[c,m]=i.useState(!1),[o,g]=i.useState(!1),[r,h]=i.useState(0);i.useEffect(()=>{Object.keys(l).length>0&&a({})},[s]),i.useEffect(()=>{let t;return r>0&&(t=setTimeout(()=>h(r-1),1e3)),()=>clearTimeout(t)},[r]);const N=()=>{const t={};return s.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)||(t.email="Email không hợp lệ"):t.email="Vui lòng nhập email",a(t),Object.keys(t).length===0},v=t=>{const{name:n,value:E}=t.target;x(S=>({...S,[n]:E}))},k=async t=>{if(t.preventDefault(),!!N()){m(!0),a({});try{if(!O.checkRateLimit(s.email,"forgot-password")){a({general:"Quá nhiều yêu cầu. Vui lòng thử lại sau."});return}const n=await b.forgotPassword(s.email);n.error?a({general:n.error||"Có lỗi xảy ra, vui lòng thử lại"}):(g(!0),h(60),d.success("Email khôi phục đã được gửi!"))}catch(n){console.error("Forgot password error:",n),a({general:"Có lỗi xảy ra, vui lòng thử lại sau"})}finally{m(!1)}}},w=async()=>{if(!(r>0||c)){m(!0);try{(await b.forgotPassword(s.email)).error?d.error("Không thể gửi lại email, vui lòng thử lại"):(h(60),d.success("Email đã được gửi lại!"))}catch{d.error("Có lỗi xảy ra")}finally{m(!1)}}},C=()=>{g(!1),h(0),x({email:""}),a({})};return e.jsx(G,{title:"Khôi phục tài khoản",subtitle:"Đừng lo lắng, chúng tôi sẽ giúp bạn lấy lại quyền truy cập",children:e.jsxs(T,{className:"shadow-xl border-0",children:[e.jsxs(D,{className:"text-center pb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center mb-4",children:o?e.jsx(y,{className:"w-8 h-8 text-white"}):e.jsx(I,{className:"w-8 h-8 text-white"})}),e.jsx(L,{className:"text-2xl font-bold text-gray-800",children:o?"Email đã được gửi!":"Quên mật khẩu?"}),e.jsx(Q,{className:"text-gray-600",children:o?"Vui lòng kiểm tra email để đặt lại mật khẩu":"Nhập email để nhận liên kết đặt lại mật khẩu"})]}),e.jsx(A,{className:"space-y-6",children:o?e.jsxs(e.Fragment,{children:[e.jsxs(j,{className:"border-green-200 bg-green-50",children:[e.jsx(y,{className:"h-4 w-4 text-green-600"}),e.jsxs(f,{className:"text-green-800",children:["Email khôi phục đã được gửi đến ",e.jsx("strong",{children:s.email})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Hướng dẫn tiếp theo:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"1. Kiểm tra hộp thư đến của bạn"}),e.jsx("li",{children:"2. Tìm email từ Yapee (kiểm tra cả thư mục spam)"}),e.jsx("li",{children:"3. Nhấp vào liên kết trong email"}),e.jsx("li",{children:"4. Tạo mật khẩu mới"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Không nhận được email?"}),e.jsx(u,{variant:"outline",onClick:w,disabled:r>0||c,className:"w-full",children:r>0?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Gửi lại sau ",r,"s"]}):"Gửi lại email"})]}),e.jsx("div",{className:"text-center",children:e.jsx(u,{variant:"ghost",onClick:C,className:"text-orange-600 hover:text-orange-700",children:"Sử dụng email khác"})}),e.jsx("div",{className:"text-center pt-4 border-t",children:e.jsx(p,{to:"/login",className:"text-gray-600 hover:text-gray-800 text-sm",children:"← Quay lại trang đăng nhập"})})]})]}):e.jsxs(e.Fragment,{children:[l.general&&e.jsx(j,{variant:"destructive",children:e.jsx(f,{children:l.general})}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"email",className:"text-gray-700 font-medium",children:"Email đăng ký"}),e.jsx(K,{id:"email",name:"email",type:"email",value:s.email,onChange:v,placeholder:"Nhập email của bạn",className:`h-12 ${l.email?"border-red-500 focus:border-red-500":""}`,disabled:c}),l.email&&e.jsx("p",{className:"text-red-500 text-sm",children:l.email})]}),e.jsx(u,{type:"submit",disabled:c,className:"w-full h-12 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-semibold",children:c?"Đang gửi...":"Gửi email khôi phục"})]}),e.jsx("div",{className:"text-center pt-4 border-t",children:e.jsx(p,{to:"/login",className:"text-gray-600 hover:text-gray-800 text-sm",children:"← Quay lại trang đăng nhập"})})]})})]})})};export{Z as default};
//# sourceMappingURL=ForgotPasswordPage-DEcOZM5r.js.map
