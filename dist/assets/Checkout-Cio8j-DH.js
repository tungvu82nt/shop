import{j as e}from"./ui-vendor-S1POobSh.js";import{r as u,u as A}from"./react-vendor-DrHQLvTy.js";import{n as J,c as C,i as P,j as D,d as S,g as $,B as g,Y as M,w as ee,D as O,p as B,R as H,V as X,_ as U,l as E,I as T,$ as z,a as K,K as f,a0 as se,a1 as ne,X as ie,t as ae,b as R,q as re,m as F}from"./index-B_z83aGI.js";import{p as te}from"./paymentService-C8Me4PBo.js";import{M as Z}from"./map-pin-Cx6R8BJE.js";import{S as ce}from"./square-pen-CGjNjVrq.js";import{T as V}from"./truck-BPY7BSqw.js";import{S as _}from"./shield-CnI5vR7_.js";import{C as I}from"./credit-card-DMGlkA9B.js";import{Z as le}from"./zap-B1yNdpZ8.js";import{G as L}from"./gift-Cnrm8-ER.js";import{A as he}from"./arrow-left-Bup_IKS6.js";import"./chart-vendor-Bfyd95vO.js";import"./supabase-vendor-C-7U-qZP.js";import"./form-vendor-CeA2iSy3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=J("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),de=({selectedAddress:s,onAddressSelect:o,onNext:d})=>{const[p,a]=u.useState(!1),[x,h]=u.useState(null),[c,n]=u.useState(null),[r,m]=u.useState(!1),v=async t=>{m(!0);try{const{error:j}=await z.from("user_addresses").update({name:t.name,phone:t.phone,address:t.address,ward:t.ward,district:t.district,province:t.province,is_default:t.isDefault,updated_at:new Date().toISOString()}).eq("id",t.id);j?(console.error("Lỗi cập nhật địa chỉ:",j),alert("Có lỗi xảy ra khi cập nhật địa chỉ")):(console.log("Cập nhật địa chỉ thành công"),h(null),window.location.reload())}catch(j){console.error("Lỗi:",j),alert("Có lỗi xảy ra")}finally{m(!1)}},y=async t=>{m(!0);try{const{error:j}=await z.from("user_addresses").delete().eq("id",t);j?(console.error("Lỗi xóa địa chỉ:",j),alert("Có lỗi xảy ra khi xóa địa chỉ")):(console.log("Xóa địa chỉ thành công"),n(null),window.location.reload())}catch(j){console.error("Lỗi:",j),alert("Có lỗi xảy ra")}finally{m(!1)}},[b]=u.useState([{id:"1",name:"Nguyễn Văn A",phone:"0123456789",address:"123 Đường ABC, Phường XYZ",ward:"Phường 1",district:"Quận 1",province:"TP. Hồ Chí Minh",isDefault:!0},{id:"2",name:"Nguyễn Văn B",phone:"0987654321",address:"456 Đường DEF, Phường UVW",ward:"Phường 2",district:"Quận 3",province:"TP. Hồ Chí Minh",isDefault:!1}]),l=t=>{o(t)},w=()=>{s&&d()},k=t=>`${t.address}, ${t.ward}, ${t.district}, ${t.province}`;return e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(P,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Địa chỉ giao hàng"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:b.map(t=>e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${(s==null?void 0:s.id)===t.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l(t),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-medium",children:t.name}),e.jsx("span",{className:"text-gray-600",children:"|"}),e.jsx("span",{className:"text-gray-600",children:t.phone}),t.isDefault&&e.jsx($,{variant:"secondary",className:"text-xs",children:"Mặc định"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:k(t)})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:j=>{j.stopPropagation(),h(t)},children:e.jsx(ce,{className:"h-4 w-4"})}),!t.isDefault&&e.jsx(g,{variant:"ghost",size:"sm",onClick:j=>{j.stopPropagation(),n(t.id)},children:e.jsx(M,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center mt-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${(s==null?void 0:s.id)===t.id?"border-blue-500":"border-gray-300"}`,children:(s==null?void 0:s.id)===t.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:(s==null?void 0:s.id)===t.id?"Đã chọn":"Chọn địa chỉ này"})]})]},t.id))}),e.jsxs(g,{variant:"outline",className:"w-full",onClick:()=>a(!0),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Thêm địa chỉ mới"]}),p&&e.jsx(C,{className:"border-dashed",children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Form thêm địa chỉ mới sẽ được triển khai ở bước tiếp theo."}),e.jsx(g,{variant:"outline",onClick:()=>a(!1),children:"Đóng"})]})})}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(g,{onClick:w,disabled:!s,className:"bg-blue-600 hover:bg-blue-700",children:"Tiếp tục"})})]})]}),e.jsx(O,{open:!!x,onOpenChange:()=>h(null),children:e.jsxs(B,{className:"sm:max-w-[425px]",children:[e.jsx(H,{children:e.jsx(X,{children:"Chỉnh sửa địa chỉ"})}),x&&e.jsx(me,{address:x,onSave:v,onCancel:()=>h(null),isLoading:r})]})}),e.jsx(O,{open:!!c,onOpenChange:()=>n(null),children:e.jsxs(B,{className:"sm:max-w-[425px]",children:[e.jsx(H,{children:e.jsx(X,{children:"Xác nhận xóa địa chỉ"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Bạn có chắc chắn muốn xóa địa chỉ này không? Hành động này không thể hoàn tác."})}),e.jsxs(U,{children:[e.jsx(g,{variant:"outline",onClick:()=>n(null),disabled:r,children:"Hủy"}),e.jsx(g,{variant:"destructive",onClick:()=>c&&y(c),disabled:r,children:r?"Đang xóa...":"Xóa"})]})]})})]})},me=({address:s,onSave:o,onCancel:d,isLoading:p})=>{const[a,x]=u.useState(s),h=c=>{c.preventDefault(),o(a)};return e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"name",children:"Tên người nhận"}),e.jsx(T,{id:"name",value:a.name,onChange:c=>x({...a,name:c.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"phone",children:"Số điện thoại"}),e.jsx(T,{id:"phone",value:a.phone,onChange:c=>x({...a,phone:c.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"address",children:"Địa chỉ chi tiết"}),e.jsx(T,{id:"address",value:a.address,onChange:c=>x({...a,address:c.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"ward",children:"Phường/Xã"}),e.jsx(T,{id:"ward",value:a.ward,onChange:c=>x({...a,ward:c.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"district",children:"Quận/Huyện"}),e.jsx(T,{id:"district",value:a.district,onChange:c=>x({...a,district:c.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"province",children:"Tỉnh/Thành phố"}),e.jsx(T,{id:"province",value:a.province,onChange:c=>x({...a,province:c.target.value}),required:!0})]})]}),e.jsxs(U,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:d,disabled:p,children:"Hủy"}),e.jsx(g,{type:"submit",disabled:p,children:p?"Đang lưu...":"Lưu thay đổi"})]})]})},xe=({selectedMethod:s,onMethodSelect:o,onNext:d,onPrev:p})=>{const[a]=u.useState([{id:"standard",name:"Giao hàng tiêu chuẩn",description:"Giao hàng trong giờ hành chính",estimatedTime:"3-5 ngày làm việc",fee:3e4,icon:V,features:["Miễn phí với đơn hàng trên 500k","Giao trong giờ hành chính"]},{id:"express",name:"Giao hàng nhanh",description:"Giao hàng ưu tiên trong ngày",estimatedTime:"1-2 ngày làm việc",fee:5e4,icon:K,features:["Giao hàng ưu tiên","Theo dõi real-time"],isRecommended:!0},{id:"premium",name:"Giao hàng cao cấp",description:"Giao hàng trong 24h với bảo hiểm",estimatedTime:"Trong 24 giờ",fee:8e4,icon:_,features:["Giao trong 24h","Bảo hiểm 100%","Hỗ trợ 24/7"]}]),x=n=>{o(n)},h=()=>{s&&d()},c=(n,r=0)=>n.id==="standard"&&r>=5e5;return e.jsxs(C,{children:[e.jsx(P,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Phương thức vận chuyển"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:a.map(n=>{const r=n.icon,m=c(n);return e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors relative ${(s==null?void 0:s.id)===n.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>x(n),children:[n.isRecommended&&e.jsx($,{className:"absolute -top-2 -right-2 bg-orange-500 hover:bg-orange-600",children:"Khuyến nghị"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${(s==null?void 0:s.id)===n.id?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(r,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:n.name}),e.jsx("div",{className:"text-right",children:m?e.jsxs("div",{children:[e.jsx("span",{className:"text-green-600 font-medium",children:"Miễn phí"}),e.jsx("div",{className:"text-xs text-gray-500 line-through",children:f(n.fee)})]}):e.jsx("span",{className:"font-medium",children:f(n.fee)})})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:n.description}),e.jsx("div",{className:"flex items-center gap-4 mb-3",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:n.estimatedTime})]})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.features.map((v,y)=>e.jsx($,{variant:"secondary",className:"text-xs",children:v},y))})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center mt-1 ${(s==null?void 0:s.id)===n.id?"border-blue-500":"border-gray-300"}`,children:(s==null?void 0:s.id)===n.id&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-blue-500"})})]})]},n.id)})}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-yellow-800 mb-2",children:"Lưu ý vận chuyển:"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• Miễn phí vận chuyển cho đơn hàng từ 500.000đ (áp dụng giao hàng tiêu chuẩn)"}),e.jsx("li",{children:"• Thời gian giao hàng có thể thay đổi tùy theo khu vực"}),e.jsx("li",{children:"• Đơn hàng sẽ được xác nhận qua SMS/Email"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(g,{variant:"outline",onClick:p,className:"flex-1",children:"Quay lại"}),e.jsx(g,{onClick:h,disabled:!s,className:"bg-blue-600 hover:bg-blue-700 flex-1",children:"Tiếp tục"})]})]})]})},ge=({selectedMethod:s,onMethodSelect:o,onNext:d,onPrev:p,orderTotal:a})=>{const[x]=u.useState([{id:"vnpay",name:"VNPay",description:"Thanh toán qua VNPay (ATM, Visa, MasterCard)",icon:I,processingTime:"Tức thì",features:["Bảo mật cao","Hỗ trợ nhiều ngân hàng","Hoàn tiền nhanh"],isPopular:!0},{id:"momo",name:"Ví MoMo",description:"Thanh toán qua ví điện tử MoMo",icon:se,processingTime:"Tức thì",features:["Thanh toán nhanh","Tích điểm","Ưu đãi độc quyền"],discount:5},{id:"zalopay",name:"ZaloPay",description:"Thanh toán qua ví điện tử ZaloPay",icon:le,processingTime:"Tức thì",features:["Bảo mật 2 lớp","Cashback","Liên kết ngân hàng"]},{id:"banking",name:"Chuyển khoản ngân hàng",description:"Chuyển khoản trực tiếp qua Internet Banking",icon:_,processingTime:"1-2 giờ",features:["An toàn tuyệt đối","Không phí giao dịch","Xác nhận tự động"]},{id:"cod",name:"Thanh toán khi nhận hàng (COD)",description:"Thanh toán bằng tiền mặt khi nhận hàng",icon:oe,processingTime:"Khi giao hàng",features:["Kiểm tra hàng trước khi trả tiền","Không cần thẻ ngân hàng","Phù hợp mọi đối tượng"]}]),h=r=>{o(r)},c=()=>{s&&d()},n=r=>r.discount?a*r.discount/100:0;return e.jsxs(C,{children:[e.jsx(P,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Phương thức thanh toán"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:x.map(r=>{const m=r.icon,v=n(r);return e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors relative ${(s==null?void 0:s.id)===r.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>h(r),children:[r.isPopular&&e.jsx($,{className:"absolute -top-2 -right-2 bg-green-500 hover:bg-green-600",children:"Phổ biến"}),r.discount&&e.jsxs($,{className:"absolute -top-2 -left-2 bg-red-500 hover:bg-red-600",children:["Giảm ",r.discount,"%"]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${(s==null?void 0:s.id)===r.id?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(m,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:r.name}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Xử lý: ",r.processingTime]}),v>0&&e.jsxs("div",{className:"text-sm text-green-600 font-medium",children:["Tiết kiệm: ",v.toLocaleString("vi-VN"),"đ"]})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:r.description}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.features.map((y,b)=>e.jsx($,{variant:"secondary",className:"text-xs",children:y},b))})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center mt-1 ${(s==null?void 0:s.id)===r.id?"border-blue-500":"border-gray-300"}`,children:(s==null?void 0:s.id)===r.id&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-blue-500"})})]})]},r.id)})}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_,{className:"h-5 w-5 text-green-600"}),e.jsx("h5",{className:"font-medium text-green-800",children:"Thanh toán an toàn"})]}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• Thông tin thanh toán được mã hóa SSL 256-bit"}),e.jsx("li",{children:"• Không lưu trữ thông tin thẻ tín dụng"}),e.jsx("li",{children:"• Tuân thủ tiêu chuẩn bảo mật PCI DSS"}),e.jsx("li",{children:"• Hỗ trợ hoàn tiền 100% nếu có sự cố"})]})]}),(s==null?void 0:s.discount)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-blue-800",children:"Ưu đãi thanh toán"}),e.jsxs("p",{className:"text-sm text-blue-600",children:["Giảm ",s.discount,"% khi thanh toán qua ",s.name]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["-",n(s).toLocaleString("vi-VN"),"đ"]})})]})}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(g,{variant:"outline",onClick:p,className:"flex-1",children:"Quay lại"}),e.jsx(g,{onClick:c,disabled:!s,className:"bg-blue-600 hover:bg-blue-700 flex-1",children:"Tiếp tục"})]})]})]})},Q=[{code:"WELCOME10",discount:5e4,type:"fixed",description:"Giảm 50.000đ cho đơn hàng đầu tiên",minOrder:2e5},{code:"SAVE15",discount:15,type:"percent",description:"Giảm 15% cho đơn hàng từ 500.000đ",minOrder:5e5},{code:"FREESHIP",discount:3e4,type:"shipping",description:"Miễn phí vận chuyển",minOrder:1e5}],ue=({onCouponApply:s,appliedCoupon:o,orderTotal:d})=>{const[p,a]=u.useState(""),[x,h]=u.useState(!1),[c,n]=u.useState(""),[r,m]=u.useState(!1),v=async()=>{if(!p.trim()){n("Vui lòng nhập mã giảm giá");return}h(!0),n("");try{await new Promise(w=>setTimeout(w,1e3));const l=Q.find(w=>w.code.toLowerCase()===p.toLowerCase());if(!l){n("Mã giảm giá không hợp lệ");return}if(d<l.minOrder){n(`Đơn hàng tối thiểu ${f(l.minOrder)} để sử dụng mã này`);return}s(l.discount,l.code),a(""),m(!1)}catch{n("Có lỗi xảy ra khi áp dụng mã giảm giá")}finally{h(!1)}},y=()=>{s(0,"")},b=l=>{a(l),m(!1)};return e.jsxs(C,{children:[e.jsx(P,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Mã giảm giá"]})}),e.jsxs(S,{className:"space-y-4",children:[o&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:o.code}),e.jsxs("p",{className:"text-sm text-green-600",children:["Giảm ",f(o.discount)]})]})]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:y,className:"text-green-600 hover:text-green-800",children:e.jsx(ie,{className:"h-4 w-4"})})]}),!o&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{placeholder:"Nhập mã giảm giá",value:p,onChange:l=>{a(l.target.value),n("")},onFocus:()=>m(!0),className:c?"border-red-500":""}),e.jsx(g,{onClick:v,disabled:x||!p.trim(),className:"bg-blue-600 hover:bg-blue-700",children:x?"Đang áp dụng...":"Áp dụng"})]}),c&&e.jsx("p",{className:"text-sm text-red-600",children:c}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Mã giảm giá có sẵn:"}),e.jsx("div",{className:"space-y-2",children:Q.map(l=>e.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg cursor-pointer hover:bg-gray-50",onClick:()=>b(l.code),children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"secondary",children:l.code}),l.type==="percent"&&e.jsxs("span",{className:"text-sm text-green-600",children:["-",l.discount,"%"]}),l.type==="fixed"&&e.jsxs("span",{className:"text-sm text-green-600",children:["-",f(l.discount)]}),l.type==="shipping"&&e.jsx("span",{className:"text-sm text-green-600",children:"Miễn phí ship"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:l.description}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Đơn tối thiểu: ",f(l.minOrder)]})]})},l.code))})]})]})]})]})},qe=()=>{const s=A(),{state:o}=ae(),[d,p]=u.useState(1),[a,x]=u.useState(null),[h,c]=u.useState(null),[n,r]=u.useState(null),[m,v]=u.useState(null);u.useEffect(()=>{R.trackEcommerce("begin_checkout",{currency:"VND",value:o.totalPrice,items:o.items.map(i=>({item_id:i.id.toString(),item_name:i.name,item_category:i.category,item_brand:i.brand,price:i.price,quantity:i.quantity}))})},[o]);const y=o.totalPrice,b=(h==null?void 0:h.fee)||0,l=n!=null&&n.discount?y*n.discount/100:0,w=(m==null?void 0:m.discount)||0,k=y+b-w-l,t=()=>{s(-1)},j=()=>{d<4&&p(d+1)},G=()=>{d>1&&p(d-1)},W=(i,N)=>{i>0&&N?v({discount:i,code:N}):v(null)},Y=async()=>{try{if(!a||!h||!n){F.error("Vui lòng điền đầy đủ thông tin đặt hàng!");return}const i="ORD"+Date.now();if(n.id==="cod"||n.id==="bank_transfer")await new Promise(N=>setTimeout(N,1e3)),console.log("Đặt hàng thành công:",{orderId:i,address:a,shipping:h,payment:n,items:o.items,total:k}),R.trackEcommerce("purchase",{transaction_id:i,currency:"VND",value:k,shipping:b,payment_type:n.id,items:o.items.map(N=>({item_id:N.id.toString(),item_name:N.name,item_category:N.category,item_brand:N.brand,price:N.price,quantity:N.quantity}))}),F.success("Đặt hàng thành công!"),s(`/order-success?orderId=${i}`);else{const N={orderId:i,amount:k,orderInfo:`Thanh toán đơn hàng ${i}`,returnUrl:`${window.location.origin}/payment-result?method=${n.id}`,cancelUrl:`${window.location.origin}/checkout`,paymentMethod:n.id},q=await te.processPayment(N);if(q.success&&q.paymentUrl)localStorage.setItem("pendingOrder",JSON.stringify({orderId:i,address:a,shipping:h,payment:n,items:o.items,total:k})),F.success("Đang chuyển hướng đến trang thanh toán..."),window.location.href=q.paymentUrl;else throw new Error(q.message||"Không thể tạo liên kết thanh toán")}}catch(i){console.error("Error placing order:",i),F.error(i instanceof Error?i.message:"Có lỗi xảy ra khi đặt hàng. Vui lòng thử lại!")}};return o.items.length===0?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Giỏ hàng trống"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Vui lòng thêm sản phẩm vào giỏ hàng trước khi thanh toán."}),e.jsx(g,{onClick:()=>s("/"),className:"bg-blue-600 hover:bg-blue-700",children:"Tiếp tục mua sắm"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(g,{variant:"ghost",size:"sm",onClick:t,className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Quay lại"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Thanh toán"})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(C,{children:e.jsx(S,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:[{step:1,title:"Địa chỉ",icon:Z},{step:2,title:"Vận chuyển",icon:V},{step:3,title:"Thanh toán",icon:I},{step:4,title:"Xác nhận",icon:L}].map(({step:i,title:N,icon:q})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full ${d>=i?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:e.jsx(q,{className:"h-5 w-5"})}),e.jsx("span",{className:`ml-2 text-sm font-medium ${d>=i?"text-blue-600":"text-gray-600"}`,children:N}),i<4&&e.jsx("div",{className:`w-16 h-0.5 mx-4 ${d>i?"bg-blue-600":"bg-gray-200"}`})]},i))})})}),d===1&&e.jsx(de,{selectedAddress:a,onAddressSelect:x,onNext:j}),d===2&&e.jsx(xe,{selectedMethod:h,onMethodSelect:c,onNext:j,onPrev:G}),d===3&&e.jsx(ge,{selectedMethod:n,onMethodSelect:r,onNext:j,onPrev:G,orderTotal:y}),d===4&&e.jsxs(C,{children:[e.jsx(P,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Xác nhận đơn hàng"]})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[a&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Địa chỉ giao hàng:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:a.name})," | ",a.phone]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.address,", ",a.ward,", ",a.district,", ",a.province]})]}),h&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Phương thức vận chuyển:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:h.name})," - ",f(h.fee)]}),e.jsx("p",{className:"text-sm text-gray-600",children:h.estimatedTime})]}),n&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Phương thức thanh toán:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:n.name}),n.discount&&e.jsxs("span",{className:"text-green-600 ml-2",children:["(Giảm ",n.discount,"%)"]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:n.description})]})]}),e.jsx("div",{className:"text-sm text-gray-600",children:e.jsx("p",{children:"Vui lòng kiểm tra lại thông tin đơn hàng trước khi đặt hàng."})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(g,{variant:"outline",onClick:G,children:"Quay lại"}),e.jsx(g,{onClick:Y,className:"bg-green-600 hover:bg-green-700 flex-1",children:"Đặt hàng"})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(P,{children:e.jsx(D,{children:"Đơn hàng của bạn"})}),e.jsx(S,{className:"space-y-4",children:o.items.map(i=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:i.images[0],alt:i.name,className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:i.name}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[i.selectedColor&&e.jsxs("p",{children:["Màu: ",i.selectedColor]}),i.selectedSize&&e.jsxs("p",{children:["Kích thước: ",i.selectedSize]}),e.jsxs("p",{children:["Số lượng: ",i.quantity]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-medium text-sm",children:f(i.price*i.quantity)})})]},`${i.id}-${i.selectedColor}-${i.selectedSize}`))})]}),e.jsx(ue,{onCouponApply:W,appliedCoupon:m,orderTotal:y}),e.jsxs(C,{children:[e.jsx(P,{children:e.jsx(D,{className:"text-base",children:"Tóm tắt đơn hàng"})}),e.jsxs(S,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Tạm tính (",o.totalItems," sản phẩm)"]}),e.jsx("span",{children:f(y)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Phí vận chuyển"}),e.jsx("span",{children:b>0?f(b):"Miễn phí"})]}),w>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsxs("span",{children:["Mã giảm giá (",m==null?void 0:m.code,")"]}),e.jsxs("span",{children:["-",f(w)]})]}),l>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Giảm giá thanh toán"}),e.jsxs("span",{children:["-",f(l)]})]}),e.jsx(re,{}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Tổng cộng"}),e.jsx("span",{className:"text-red-600",children:f(k)})]})]})]})]})]})})]})};export{qe as default};
//# sourceMappingURL=Checkout-Cio8j-DH.js.map
