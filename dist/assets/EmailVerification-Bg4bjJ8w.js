import{j as e}from"./ui-vendor-S1POobSh.js";import{k as R,u as P,r as j}from"./react-vendor-DrHQLvTy.js";import{$ as h,m as t,u as A,c as m,i as u,M as c,j as x,k as d,d as p,O as b,Q as V,B as n,a5 as y}from"./index-B_z83aGI.js";import{A as N}from"./arrow-left-Bup_IKS6.js";import{C as B}from"./circle-x-CvsfpNQ6.js";import{C as $}from"./circle-check-big-DJfGvp7v.js";import"./chart-vendor-Bfyd95vO.js";import"./supabase-vendor-C-7U-qZP.js";import"./form-vendor-CeA2iSy3.js";class k{static async sendVerificationEmail(r){try{const{error:s}=await h.auth.resend({type:"signup",email:r,options:{emailRedirectTo:`${window.location.origin}/auth/verify-email`}});return s?(console.error("Lỗi gửi email xác thực:",s),t.error("Không thể gửi email xác thực. Vui lòng thử lại."),!1):(t.success("Email xác thực đã được gửi. Vui lòng kiểm tra hộp thư."),!0)}catch(s){return console.error("Lỗi gửi email xác thực:",s),t.error("Có lỗi xảy ra khi gửi email xác thực."),!1}}static async verifyEmail(r,s){try{const{error:a}=await h.auth.verifyOtp({token_hash:r,type:"email",email:s});return a?(console.error("Lỗi xác thực email:",a),t.error("Token xác thực không hợp lệ hoặc đã hết hạn."),!1):(t.success("Email đã được xác thực thành công!"),!0)}catch(a){return console.error("Lỗi xác thực email:",a),t.error("Có lỗi xảy ra khi xác thực email."),!1}}static async sendPasswordResetEmail(r){try{const{error:s}=await h.auth.resetPasswordForEmail(r,{redirectTo:`${window.location.origin}/auth/reset-password`});return s?(console.error("Lỗi gửi email reset password:",s),t.error("Không thể gửi email reset password. Vui lòng thử lại."),!1):(t.success("Email reset password đã được gửi. Vui lòng kiểm tra hộp thư."),!0)}catch(s){return console.error("Lỗi gửi email reset password:",s),t.error("Có lỗi xảy ra khi gửi email reset password."),!1}}static async sendOrderConfirmationEmail(r,s){try{return console.log("Gửi email xác nhận đơn hàng:",{to:r,subject:`Xác nhận đơn hàng #${s.orderId}`,orderData:s}),await new Promise(a=>setTimeout(a,1e3)),t.success("Email xác nhận đơn hàng đã được gửi."),!0}catch(a){return console.error("Lỗi gửi email xác nhận đơn hàng:",a),t.error("Có lỗi xảy ra khi gửi email xác nhận đơn hàng."),!1}}static async sendOrderStatusEmail(r,s){try{return console.log("Gửi email cập nhật trạng thái đơn hàng:",{to:r,subject:`Cập nhật đơn hàng #${s.orderId}`,orderData:s}),await new Promise(a=>setTimeout(a,1e3)),t.success("Email cập nhật trạng thái đã được gửi."),!0}catch(a){return console.error("Lỗi gửi email cập nhật trạng thái:",a),t.error("Có lỗi xảy ra khi gửi email cập nhật trạng thái."),!1}}static async checkEmailVerificationStatus(){try{const{data:{user:r}}=await h.auth.getUser();return r?r.email_confirmed_at!==null:!1}catch(r){return console.error("Lỗi kiểm tra trạng thái email verification:",r),!1}}}const F=()=>{const[g]=R(),r=P(),{user:s,refreshUser:a}=A(),[L,l]=j.useState("loading"),[o,C]=j.useState(!1),f=g.get("token"),i=g.get("email")||(s==null?void 0:s.email);j.useEffect(()=>{(async()=>{f&&i?await k.verifyEmail(f,i)?(l("success"),await a(),setTimeout(()=>{r("/",{replace:!0})},3e3)):l("error"):s?await k.checkEmailVerificationStatus()?(l("success"),setTimeout(()=>{r("/",{replace:!0})},2e3)):l("pending"):r("/auth/login",{replace:!0})})()},[f,i,s,r,a]);const E=async()=>{if(!i){t.error("Không tìm thấy email để gửi lại.");return}C(!0);const v=await k.sendVerificationEmail(i);C(!1),v&&t.success("Email xác thực đã được gửi lại!")},w=()=>{r("/",{replace:!0})},S=()=>{switch(L){case"loading":return e.jsx(m,{className:"w-full max-w-md mx-auto",children:e.jsxs(u,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(y,{className:"w-8 h-8 text-blue-600 animate-spin"})}),e.jsx(x,{children:"Đang xác thực email..."}),e.jsx(d,{children:"Vui lòng chờ trong giây lát"})]})});case"success":return e.jsxs(m,{className:"w-full max-w-md mx-auto",children:[e.jsxs(u,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx($,{className:"w-8 h-8 text-green-600"})}),e.jsx(x,{className:"text-green-600",children:"Xác thực thành công!"}),e.jsx(d,{children:"Email của bạn đã được xác thực thành công. Bạn sẽ được chuyển về trang chủ trong giây lát."})]}),e.jsx(p,{className:"text-center",children:e.jsxs(n,{onClick:w,className:"w-full",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Về trang chủ"]})})]});case"error":return e.jsxs(m,{className:"w-full max-w-md mx-auto",children:[e.jsxs(u,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(B,{className:"w-8 h-8 text-red-600"})}),e.jsx(x,{className:"text-red-600",children:"Xác thực thất bại"}),e.jsx(d,{children:"Link xác thực không hợp lệ hoặc đã hết hạn."})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs(b,{children:[e.jsx(c,{className:"h-4 w-4"}),e.jsx(V,{children:"Vui lòng kiểm tra lại email hoặc yêu cầu gửi lại email xác thực."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{onClick:E,disabled:o,className:"w-full",variant:"outline",children:[o?e.jsx(y,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(c,{className:"w-4 h-4 mr-2"}),"Gửi lại email xác thực"]}),e.jsxs(n,{onClick:w,className:"w-full",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Về trang chủ"]})]})]})]});case"pending":return e.jsxs(m,{className:"w-full max-w-md mx-auto",children:[e.jsxs(u,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(c,{className:"w-8 h-8 text-yellow-600"})}),e.jsx(x,{className:"text-yellow-600",children:"Chờ xác thực email"}),e.jsxs(d,{children:["Chúng tôi đã gửi email xác thực đến ",e.jsx("strong",{children:i})]})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs(b,{children:[e.jsx(c,{className:"h-4 w-4"}),e.jsx(V,{children:"Vui lòng kiểm tra hộp thư (bao gồm cả thư mục spam) và nhấp vào link xác thực."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{onClick:E,disabled:o,className:"w-full",variant:"outline",children:[o?e.jsx(y,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(c,{className:"w-4 h-4 mr-2"}),"Gửi lại email xác thực"]}),e.jsxs(n,{onClick:w,className:"w-full",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Về trang chủ"]})]})]})]});default:return null}};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-md",children:S()})})};export{F as default};
//# sourceMappingURL=EmailVerification-Bg4bjJ8w.js.map
