import{j as e}from"./ui-vendor-S1POobSh.js";import{r,k as ge,u as pe}from"./react-vendor-DrHQLvTy.js";import{n as fe,E as ce,y as O,b as D,G as T,J as W,I as je,B as g,X as Z,a as Q,T as ee,g as B,l as $,S as oe,c as se,h as te,x as ae,d as ve,K as ne,N as I,O as Ne,Q as be,C as ye,m as R,r as ke}from"./index-B_z83aGI.js";import{F as de}from"./filter-CDTGhXC7.js";import{C as H}from"./checkbox-B751KjRM.js";import{S as Se}from"./slider-Cq0KOhSO.js";import{C as Ce,a as we,b as Pe}from"./collapsible-CsGVlbxX.js";import{S as me,a as he,b as xe,c as Fe,d as Te,e as ze}from"./sheet-N8TNJy76.js";import{T as ie}from"./truck-BPY7BSqw.js";import{M as ue}from"./map-pin-Cx6R8BJE.js";import{C as _e}from"./chevron-up-DCfO1O8C.js";import{C as Le}from"./chevron-down-B_2yl-Ju.js";import{Z as qe}from"./zap-B1yNdpZ8.js";import{G as Ae,L as Me}from"./list-CSrzmTAL.js";import{C as Be}from"./chevron-left-CR6IMP4N.js";import"./chart-vendor-Bfyd95vO.js";import"./supabase-vendor-C-7U-qZP.js";import"./form-vendor-CeA2iSy3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=fe("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);function Oe({onSearch:s,onFilterClick:p,placeholder:N="Tìm kiếm sản phẩm...",className:o,showFilters:b=!0,autoFocus:l=!1}){const[d,f]=r.useState(""),[j,v]=r.useState(!1),[k,P]=r.useState([]),[S,L]=r.useState([]),[z,M]=r.useState([]),[q,h]=r.useState(!1),C=r.useRef(null),w=r.useRef(null),t=r.useRef(null),a=ce(d,300);r.useEffect(()=>{L(O.getRecentSearches()),c()},[]);const c=async()=>{try{const n=await O.getTrendingSearches();M(n)}catch(n){console.error("Failed to load trending searches:",n)}};r.useEffect(()=>{a.length>=2?(t.current&&t.current.abort(),t.current=new AbortController,h(!0),O.getSuggestions(a,t.current.signal).then(P).catch(n=>{n.name!=="AbortError"&&console.error("Autocomplete error:",n)}).finally(()=>{h(!1)})):P([])},[a]);const x=r.useCallback(n=>{n.trim()&&(D.track("search_performed",{query:n.trim(),source:"search_bar"}),s==null||s(n.trim()),f(n.trim()),v(!1),O.saveSearchHistory(n.trim()),L(O.getRecentSearches()))},[s]),u=n=>{const y=n.target.value;f(y),v(y.length>0||S.length>0||z.length>0)},_=n=>{var y;n.key==="Enter"?x(d):n.key==="Escape"&&(v(!1),(y=C.current)==null||y.blur())},U=n=>{D.track("search_suggestion_clicked",{suggestion:n.text,type:n.type,source:"autocomplete"}),n.type,x(n.text)},V=n=>{D.track("search_history_clicked",{query:n,source:"search_history"}),x(n)},G=()=>{var n;f(""),P([]),v(!1),(n=C.current)==null||n.focus()},K=()=>{O.clearSearchHistory(),L([])};r.useEffect(()=>{const n=y=>{w.current&&!w.current.contains(y.target)&&C.current&&!C.current.contains(y.target)&&v(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]),r.useEffect(()=>{l&&C.current&&C.current.focus()},[l]),r.useEffect(()=>()=>{t.current&&t.current.abort()},[]);const X=j&&(k.length>0||d.length===0&&(S.length>0||z.length>0));return e.jsx("div",{className:T("relative w-full max-w-2xl",o),children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(je,{ref:C,type:"text",placeholder:N,value:d,onChange:u,onKeyDown:_,onFocus:()=>v(!0),className:"pl-10 pr-10 h-12 text-base"}),d&&e.jsx(g,{variant:"ghost",size:"sm",onClick:G,className:"absolute right-2 top-1/2 h-6 w-6 -translate-y-1/2 p-0 hover:bg-transparent",children:e.jsx(Z,{className:"h-4 w-4"})})]}),b&&e.jsxs(g,{variant:"outline",size:"lg",onClick:p,className:"ml-2 h-12 px-4",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Lọc"]})]}),X&&e.jsxs("div",{ref:w,className:"absolute top-full left-0 right-0 z-50 mt-1 bg-background border rounded-lg shadow-lg max-h-96 overflow-y-auto",children:[q&&e.jsx("div",{className:"p-4 text-center text-muted-foreground",children:"Đang tìm kiếm..."}),k.length>0&&e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground px-2 py-1 mb-1",children:"Gợi ý tìm kiếm"}),k.map((n,y)=>e.jsxs("button",{onClick:()=>U(n),className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-muted rounded-md transition-colors",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:n.text}),n.count&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.count," sản phẩm"]}),n.price&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.price.toLocaleString("vi-VN")," ₫"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground capitalize",children:[n.type==="product"&&"Sản phẩm",n.type==="category"&&"Danh mục",n.type==="brand"&&"Thương hiệu"]})]},`${n.type}-${y}`))]}),d.length===0&&S.length>0&&e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 mb-1",children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3"}),"Tìm kiếm gần đây"]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:K,className:"h-auto p-0 text-xs text-muted-foreground hover:text-foreground",children:"Xóa tất cả"})]}),S.slice(0,5).map((n,y)=>e.jsxs("button",{onClick:()=>V(n),className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-muted rounded-md transition-colors",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate",children:n})]},`history-${y}`))]}),d.length===0&&z.length>0&&e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground px-2 py-1 mb-1 flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),"Tìm kiếm phổ biến"]}),z.slice(0,5).map((n,y)=>e.jsxs("button",{onClick:()=>V(n),className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-muted rounded-md transition-colors",children:[e.jsx(ee,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate",children:n})]},`trending-${y}`))]}),k.length===0&&d.length>=2&&!q&&e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:['Không tìm thấy kết quả cho "',d,'"']})]})]})})}function E({title:s,children:p,defaultOpen:N=!0,className:o}){const[b,l]=r.useState(N);return e.jsxs(Ce,{open:b,onOpenChange:l,className:o,children:[e.jsx(we,{asChild:!0,children:e.jsxs(g,{variant:"ghost",className:"w-full justify-between p-0 h-auto font-medium text-left",children:[s,b?e.jsx(_e,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})]})}),e.jsx(Pe,{className:"mt-3",children:p})]})}function re({filters:s,currentQuery:p,onFiltersChange:N,onClearFilters:o,className:b}){const[l,d]=r.useState(p),[f,j]=r.useState([0,1e7]);r.useEffect(()=>{d(p),p.minPrice!==void 0&&p.maxPrice!==void 0&&j([p.minPrice,p.maxPrice])},[p]);const v=()=>{N({...l,minPrice:f[0]>0?f[0]:void 0,maxPrice:f[1]<1e7?f[1]:void 0})},k=(t,a)=>{d(c=>({...c,category:a?t:void 0}))},P=(t,a)=>{d(c=>{const x=Array.isArray(c.brand)?c.brand:c.brand?[c.brand]:[];if(a)return{...c,brand:[...x,t]};{const u=x.filter(_=>_!==t);return{...c,brand:u.length>0?u:void 0}}})},S=(t,a)=>{d(c=>({...c,minRating:a?t:void 0}))},L=(t,a)=>{d(c=>({...c,location:a?t:void 0}))},z=(t,a)=>{d(c=>{const x=c.shippingOptions||[];if(a)return{...c,shippingOptions:[...x,t]};{const u=x.filter(_=>_!==t);return{...c,shippingOptions:u.length>0?u:void 0}}})},M=t=>{j([t.min,t.max===1/0?1e7:t.max]),d(a=>({...a,minPrice:t.min,maxPrice:t.max===1/0?void 0:t.max}))},q=(t,a)=>{t==="in_stock"&&d(c=>({...c,inStock:a?!0:void 0}))},h=(t,a)=>{d(c=>{const x=c.tags||[];return a?{...c,tags:[...x,t]}:{...c,tags:x.filter(u=>u!==t)}})},C=t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t),w=[l.category,l.brand,l.rating,l.minPrice,l.maxPrice,l.inStock,...l.tags||[]].filter(Boolean).length;return e.jsxs("div",{className:T("space-y-6",b),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Bộ lọc"}),e.jsxs("div",{className:"flex items-center gap-2",children:[w>0&&e.jsxs(B,{variant:"secondary",children:[w," bộ lọc"]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:o,className:"text-muted-foreground hover:text-foreground",children:"Xóa tất cả"})]})]}),s.categories.length>0&&e.jsx(E,{title:"Danh mục",children:e.jsx("div",{className:"space-y-2",children:s.categories.slice(0,8).map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:`category-${t.value}`,checked:l.category===t.value,onCheckedChange:a=>k(t.value,a)}),e.jsxs($,{htmlFor:`category-${t.value}`,className:"flex-1 text-sm font-normal cursor-pointer",children:[t.label,t.count&&e.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",t.count,")"]})]})]},t.value))})}),e.jsx(E,{title:"Khoảng giá",children:e.jsxs("div",{className:"space-y-4",children:[s.priceRanges.length>0&&e.jsx("div",{className:"space-y-2",children:s.priceRanges.map((t,a)=>e.jsx("button",{onClick:()=>M(t),className:T("w-full text-left px-3 py-2 rounded-md text-sm transition-colors",t.selected?"bg-primary text-primary-foreground":"hover:bg-muted"),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:t.label}),t.count&&e.jsxs("span",{className:"text-xs opacity-70",children:["(",t.count,")"]})]})},a))}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium",children:"Tùy chỉnh"}),e.jsx(Se,{value:f,onValueChange:j,max:1e7,min:0,step:1e5,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:C(f[0])}),e.jsx("span",{children:C(f[1])})]})]})]})}),s.brands.length>0&&e.jsx(E,{title:"Thương hiệu",children:e.jsx("div",{className:"space-y-2",children:(()=>{const t=Array.isArray(l.brand)?l.brand:l.brand?[l.brand]:[];return e.jsxs(e.Fragment,{children:[s.brands.slice(0,8).map(a=>{const c=t.includes(a.value);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:`brand-${a.value}`,checked:c,onCheckedChange:x=>P(a.value,x)}),e.jsxs($,{htmlFor:`brand-${a.value}`,className:"flex-1 text-sm font-normal cursor-pointer",children:[a.label,a.count&&e.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",a.count,")"]})]})]},a.value)}),t.length>0&&e.jsx("div",{className:"pt-2",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(a=>e.jsxs(B,{variant:"secondary",className:"text-xs",children:[a,e.jsx("button",{onClick:()=>P(a,!1),className:"ml-1 hover:text-destructive",children:e.jsx(Z,{className:"h-3 w-3"})})]},a))})})]})})()})}),s.ratings.length>0&&e.jsx(E,{title:"Đánh giá",children:e.jsx("div",{className:"space-y-2",children:s.ratings.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:`rating-${t}`,checked:l.rating===t,onCheckedChange:a=>S(t,a)}),e.jsxs($,{htmlFor:`rating-${t}`,className:"flex items-center space-x-1 text-sm font-normal cursor-pointer",children:[e.jsx("div",{className:"flex items-center",children:Array.from({length:5},(a,c)=>e.jsx(oe,{className:T("h-3 w-3",c<t?"fill-yellow-400 text-yellow-400":"text-gray-300")},c))}),e.jsxs("span",{children:["từ ",t," sao trở lên"]})]})]},t))})}),s.availability.length>0&&e.jsx(E,{title:"Tình trạng",children:e.jsx("div",{className:"space-y-2",children:s.availability.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:`availability-${t.value}`,checked:t.value==="in_stock"&&l.inStock===!0||t.value==="out_of_stock"&&l.inStock===!1,onCheckedChange:a=>q(t.value,a)}),e.jsx($,{htmlFor:`availability-${t.value}`,className:"flex-1 text-sm font-normal cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.value==="in_stock"&&e.jsx(ie,{className:"h-3 w-3"}),t.label,t.count&&e.jsxs("span",{className:"text-muted-foreground",children:["(",t.count,")"]})]})})]},t.value))})}),s.tags.length>0&&e.jsx(E,{title:"Thẻ",defaultOpen:!1,children:e.jsx("div",{className:"space-y-2",children:s.tags.slice(0,10).map(t=>{var a;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:`tag-${t.value}`,checked:((a=l.tags)==null?void 0:a.includes(t.value))||!1,onCheckedChange:c=>h(t.value,c)}),e.jsxs($,{htmlFor:`tag-${t.value}`,className:"flex-1 text-sm font-normal cursor-pointer",children:[t.label,t.count&&e.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",t.count,")"]})]})]},t.value)})})}),s.locations&&s.locations.length>0&&e.jsx(E,{title:"Khu vực",defaultOpen:!1,children:e.jsx("div",{className:"space-y-2",children:s.locations.slice(0,8).map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:`location-${t.value}`,checked:l.location===t.value,onCheckedChange:a=>L(t.value,a)}),e.jsxs($,{htmlFor:`location-${t.value}`,className:"flex items-center space-x-1 text-sm font-normal cursor-pointer",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:t.label}),t.count&&e.jsxs("span",{className:"text-muted-foreground",children:["(",t.count,")"]})]})]},t.value))})}),s.shippingOptions&&s.shippingOptions.length>0&&e.jsx(E,{title:"Vận chuyển",defaultOpen:!1,children:e.jsx("div",{className:"space-y-2",children:s.shippingOptions.map(t=>{var a;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:`shipping-${t.value}`,checked:((a=l.shipping)==null?void 0:a.includes(t.value))||!1,onCheckedChange:c=>z(t.value,c)}),e.jsxs($,{htmlFor:`shipping-${t.value}`,className:"flex items-center space-x-1 text-sm font-normal cursor-pointer",children:[e.jsx(ie,{className:"h-3 w-3"}),e.jsx("span",{children:t.label}),t.count&&e.jsxs("span",{className:"text-muted-foreground",children:["(",t.count,")"]})]})]},t.value)})})}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(g,{onClick:v,className:"w-full",children:"Áp dụng bộ lọc"})})]})}function le(s){return s.isMobile?e.jsxs(me,{children:[e.jsx(he,{asChild:!0,children:e.jsx(g,{variant:"outline",size:"sm",children:"Bộ lọc"})}),e.jsxs(xe,{side:"left",className:"w-80 overflow-y-auto",children:[e.jsxs(Fe,{children:[e.jsx(Te,{children:"Bộ lọc tìm kiếm"}),e.jsx(ze,{children:"Sử dụng các bộ lọc để tìm sản phẩm phù hợp"})]}),e.jsx("div",{className:"mt-6",children:e.jsx(re,{...s})})]})]}):e.jsx("div",{className:T("w-64 flex-shrink-0",s.className),children:e.jsx("div",{className:"sticky top-4",children:e.jsx(re,{...s})})})}const $e=({result:s,onAddToCart:p,onToggleWishlist:N,onProductClick:o,isWishlisted:b=!1,showOptimizationInfo:l=!1,viewMode:d="grid",className:f})=>{const j=()=>{o==null||o(s.id)},v=h=>{h.stopPropagation(),p==null||p(s.id)},k=h=>{h.stopPropagation(),N==null||N(s.id)},P=()=>{if(!l||!s.optimizationMetadata)return null;const{optimizationMetadata:h}=s;return h.baseScore+h.personalizedScore+h.trendingScore+h.locationScore+h.seasonalScore+h.popularityScore>4.5?e.jsxs(B,{variant:"secondary",className:"absolute top-2 left-2 bg-green-100 text-green-800",children:[e.jsx(qe,{className:"w-3 h-3 mr-1"}),"Được đề xuất"]}):null},S=()=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg font-bold text-red-600",children:ne(s.price)}),s.originalPrice&&s.originalPrice>s.price&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-gray-500 line-through",children:ne(s.originalPrice)}),e.jsxs(B,{variant:"destructive",className:"text-xs",children:["-",Math.round((1-s.price/s.originalPrice)*100),"%"]})]})]}),L=()=>s.rating?e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium ml-1",children:s.rating})]}),s.reviewCount&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.reviewCount," đánh giá)"]})]}):null,z=()=>s.location?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 mb-2",children:[e.jsx(ue,{className:"w-3 h-3"}),e.jsx("span",{children:s.location})]}):null,M=()=>e.jsx("div",{className:"mb-3",children:s.inStock?e.jsx(B,{variant:"outline",className:"text-green-600 border-green-600",children:"Còn hàng"}):e.jsx(B,{variant:"outline",className:"text-red-600 border-red-600",children:"Hết hàng"})}),q=()=>{if(!l||!s.optimizationMetadata)return null;const{optimizationMetadata:h}=s;return e.jsxs("div",{className:"mt-3 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"font-medium mb-1",children:"Điểm tối ưu hóa:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:["Liên quan: ",h.baseScore.toFixed(1)]}),e.jsxs("div",{children:["Cá nhân: ",h.personalizedScore.toFixed(1)]}),e.jsxs("div",{children:["Xu hướng: ",h.trendingScore.toFixed(1)]}),e.jsxs("div",{children:["Vị trí: ",h.locationScore.toFixed(1)]}),e.jsxs("div",{children:["Mùa vụ: ",h.seasonalScore.toFixed(1)]}),e.jsxs("div",{children:["Phổ biến: ",h.popularityScore.toFixed(1)]})]}),s.relevanceScore&&e.jsxs("div",{className:"mt-1 font-medium",children:["Điểm tổng: ",s.relevanceScore.toFixed(2)]})]})};return d==="list"?e.jsxs(se,{className:T("group cursor-pointer hover:shadow-lg transition-all duration-200 relative overflow-hidden",!s.inStock&&"opacity-75",f),onClick:j,children:[P(),e.jsxs("div",{className:"flex gap-4 p-4",children:[e.jsx("div",{className:"relative w-24 h-24 flex-shrink-0",children:e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-full object-cover rounded-md group-hover:scale-105 transition-transform duration-200",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-sm line-clamp-2 mb-2 group-hover:text-blue-600 transition-colors",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:s.description}),e.jsxs("div",{className:"flex gap-1 mb-2",children:[s.category&&e.jsx(B,{variant:"outline",className:"text-xs",children:s.category}),s.brand&&e.jsx(B,{variant:"outline",className:"text-xs",children:s.brand})]}),L(),z(),S(),M()]}),e.jsxs("div",{className:"flex flex-col gap-2 justify-center",children:[e.jsx(g,{variant:"ghost",size:"sm",className:T("p-2 rounded-full",b&&"text-red-500"),onClick:k,children:e.jsx(te,{className:T("w-4 h-4",b&&"fill-current")})}),e.jsx(g,{size:"sm",onClick:v,disabled:!s.inStock,children:e.jsx(ae,{className:"w-4 h-4"})})]})]}),l&&e.jsx("div",{className:"px-4 pb-4",children:q()})]}):e.jsxs(se,{className:T("group cursor-pointer hover:shadow-lg transition-all duration-200 relative overflow-hidden",!s.inStock&&"opacity-75",f),onClick:j,children:[P(),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-200",loading:"lazy"}),e.jsx(g,{variant:"ghost",size:"sm",className:T("absolute top-2 right-2 p-2 rounded-full bg-white/80 hover:bg-white",b&&"text-red-500"),onClick:k,children:e.jsx(te,{className:T("w-4 h-4",b&&"fill-current")})})]}),e.jsxs(ve,{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-sm line-clamp-2 mb-2 group-hover:text-blue-600 transition-colors",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:s.description}),e.jsxs("div",{className:"flex gap-1 mb-2",children:[s.category&&e.jsx(B,{variant:"outline",className:"text-xs",children:s.category}),s.brand&&e.jsx(B,{variant:"outline",className:"text-xs",children:s.brand})]}),L(),z(),S(),M(),e.jsxs(g,{className:"w-full mt-2",size:"sm",onClick:v,disabled:!s.inStock,children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),s.inStock?"Thêm vào giỏ":"Hết hàng"]}),q()]})]})},He=({searchResponse:s,isLoading:p=!1,error:N=null,onAddToCart:o,onToggleWishlist:b,onProductClick:l,onPageChange:d,wishlistedItems:f=new Set,viewMode:j="grid",onViewModeChange:v,showOptimizationInfo:k=!1,onToggleOptimizationInfo:P,className:S})=>{const L=()=>e.jsx("div",{className:T("grid gap-4",j==="grid"?"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4":"grid-cols-1"),children:Array.from({length:8}).map((t,a)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{className:"h-48 w-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"h-4 w-3/4"}),e.jsx(I,{className:"h-4 w-1/2"}),e.jsx(I,{className:"h-6 w-1/4"})]})]},a))}),z=()=>N?e.jsx(Ne,{className:"my-4",children:e.jsx(be,{children:N})}):null,M=()=>!s||s.results.length>0?null:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Không tìm thấy sản phẩm nào"}),e.jsx("p",{className:"text-gray-500",children:"Hãy thử tìm kiếm với từ khóa khác hoặc điều chỉnh bộ lọc"})]}),q=()=>!s||p?null:e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Hiển thị ",s.results.length," trong số ",s.total," sản phẩm",s.searchTime&&e.jsxs("span",{className:"ml-2",children:["(",s.searchTime,"ms)"]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[P&&e.jsxs(g,{variant:k?"default":"outline",size:"sm",onClick:P,className:"text-xs",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"Debug"]}),v&&e.jsxs("div",{className:"flex border rounded-md",children:[e.jsx(g,{variant:j==="grid"?"default":"ghost",size:"sm",onClick:()=>v("grid"),className:"rounded-r-none",children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx(g,{variant:j==="list"?"default":"ghost",size:"sm",onClick:()=>v("list"),className:"rounded-l-none",children:e.jsx(Me,{className:"w-4 h-4"})})]})]})]}),h=()=>!s||s.results.length===0?null:e.jsx("div",{className:T(j==="grid"?"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4":"space-y-4"),children:s.results.map(t=>e.jsx($e,{result:t,onAddToCart:o,onToggleWishlist:b,onProductClick:l,isWishlisted:f==null?void 0:f.includes(t.id),showOptimizationInfo:k,viewMode:j,className:j==="list"?"w-full":""},t.id))}),C=()=>{if(!s||!d||s.totalPages<=1)return null;const{currentPage:t,totalPages:a}=s,c=5,x=Math.max(1,t-Math.floor(c/2)),u=Math.min(a,x+c-1);return e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-8",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>d(t-1),disabled:t<=1,children:[e.jsx(Be,{className:"w-4 h-4"}),"Trước"]}),x>1&&e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>d(1),children:"1"}),x>2&&e.jsx("span",{className:"px-2",children:"..."})]}),Array.from({length:u-x+1},(_,U)=>x+U).map(_=>e.jsx(g,{variant:_===t?"default":"outline",size:"sm",onClick:()=>d(_),children:_},_)),u<a&&e.jsxs(e.Fragment,{children:[u<a-1&&e.jsx("span",{className:"px-2",children:"..."}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>d(a),children:a})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>d(t+1),disabled:t>=a,children:["Sau",e.jsx(ye,{className:"w-4 h-4"})]})]})},w=()=>!(s!=null&&s.suggestions)||s.suggestions.length===0?null:e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Có thể bạn muốn tìm:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.suggestions.map((t,a)=>e.jsx(g,{variant:"outline",size:"sm",className:"text-xs",onClick:()=>{console.log("Suggestion clicked:",t)},children:t.text},a))})]});return e.jsxs("div",{className:T("w-full",S),children:[z(),p?L():e.jsxs(e.Fragment,{children:[q(),w(),h(),M(),C()]})]})},De=[{id:"1",name:"iPhone 15 Pro Max 256GB",description:"Điện thoại iPhone 15 Pro Max với chip A17 Pro mạnh mẽ",price:2999e4,originalPrice:3299e4,discount:9,rating:4.8,reviewCount:1250,imageUrl:"https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=400",location:"TP. Hồ Chí Minh",isLiked:!1,isFreeShipping:!0,soldCount:2500,category:"Điện thoại",brand:"Apple",inStock:!0,tags:["flagship","camera","gaming"],sku:"IP15PM256",createdAt:"2024-01-15T00:00:00Z"},{id:"2",name:"Samsung Galaxy S24 Ultra",description:"Flagship Samsung với S Pen và camera 200MP",price:2699e4,originalPrice:2999e4,discount:10,rating:4.7,reviewCount:980,imageUrl:"https://images.unsplash.com/photo-1610945265064-0e34e5519bbf?w=400",location:"Hà Nội",isLiked:!1,isFreeShipping:!0,soldCount:1800,category:"Điện thoại",brand:"Samsung",inStock:!0,tags:["flagship","s-pen","camera"],sku:"SGS24U",createdAt:"2024-01-10T00:00:00Z"},{id:"3",name:'MacBook Pro 14" M3',description:"Laptop MacBook Pro với chip M3 cho hiệu suất vượt trội",price:5299e4,originalPrice:5499e4,discount:4,rating:4.9,reviewCount:650,imageUrl:"https://images.unsplash.com/photo-1541807084-5c52b6b3adef?w=400",location:"TP. Hồ Chí Minh",isLiked:!1,isFreeShipping:!0,soldCount:450,category:"Laptop",brand:"Apple",inStock:!0,tags:["professional","creative","performance"],sku:"MBP14M3",createdAt:"2024-01-05T00:00:00Z"},{id:"4",name:"Dell XPS 13 Plus",description:"Laptop Dell XPS 13 Plus với thiết kế premium",price:3599e4,originalPrice:3899e4,discount:8,rating:4.6,reviewCount:420,imageUrl:"https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=400",location:"Đà Nẵng",isLiked:!1,isFreeShipping:!0,soldCount:320,category:"Laptop",brand:"Dell",inStock:!0,tags:["ultrabook","business","portable"],sku:"DXPS13P",createdAt:"2024-01-12T00:00:00Z"},{id:"5",name:"AirPods Pro 2",description:"Tai nghe không dây AirPods Pro thế hệ 2",price:649e4,originalPrice:699e4,discount:7,rating:4.8,reviewCount:2100,imageUrl:"https://images.unsplash.com/photo-1606220945770-b5b6c2c55bf1?w=400",location:"TP. Hồ Chí Minh",isLiked:!1,isFreeShipping:!0,soldCount:5200,category:"Tai nghe",brand:"Apple",inStock:!0,tags:["wireless","noise-cancelling","premium"],sku:"APP2",createdAt:"2024-01-08T00:00:00Z"}];function rs(){const[s,p]=ge(),N=pe(),[o,b]=r.useState({}),[l,d]=r.useState(null),[f,j]=r.useState(!1),[v,k]=r.useState(null),[P,S]=r.useState(!1),[L,z]=r.useState(new Set),[M,q]=r.useState("grid"),[h,C]=r.useState(!1),[w,t]=r.useState(!1),a=ce(o,500);r.useEffect(()=>{w||(O.init(De),t(!0))},[w]),r.useEffect(()=>{var m;const i={q:s.get("q")||void 0,category:s.get("category")||void 0,brand:s.get("brand")||void 0,minPrice:s.get("minPrice")?Number(s.get("minPrice")):void 0,maxPrice:s.get("maxPrice")?Number(s.get("maxPrice")):void 0,rating:s.get("rating")?Number(s.get("rating")):void 0,inStock:s.get("inStock")==="true"?!0:void 0,tags:((m=s.get("tags"))==null?void 0:m.split(",").filter(Boolean))||void 0,sortBy:s.get("sortBy")||"relevance",page:s.get("page")?Number(s.get("page")):1,limit:s.get("limit")?Number(s.get("limit")):20};b(i)},[s]);const c=r.useCallback(i=>{const m=new URLSearchParams;Object.entries(i).forEach(([F,A])=>{A!=null&&A!==""&&(Array.isArray(A)?A.length>0&&m.set(F,A.join(",")):m.set(F,String(A)))}),p(m,{replace:!0})},[p]),x=r.useCallback(async i=>{if(w){j(!0),k(null);try{const m=await O.search(i);d(m),i.q&&D.track("search",{search_term:i.q,search_filters:{category:i.category,brand:i.brand,price_range:i.minPrice||i.maxPrice?{min:i.minPrice,max:i.maxPrice}:void 0,rating:i.rating,in_stock:i.inStock,tags:i.tags,sort_by:i.sortBy},results_count:m.products.length,total_results:m.total,page:i.page||1,source:"search_page"})}catch(m){const F=m instanceof Error?m.message:"Có lỗi xảy ra khi tìm kiếm";k(F),R.error(F),i.q&&D.track("search_error",{search_term:i.q,error_message:F,source:"search_page"})}finally{j(!1)}}},[w]);r.useEffect(()=>{w&&Object.keys(a).length>0&&x(a)},[a,x,w]);const u=r.useCallback(i=>{b(i),c(i)},[c]),_=r.useCallback(i=>{const m={...o,q:i,page:1};u(m)},[o,u]),U=r.useCallback(()=>{const i={q:o.q,sortBy:"relevance",page:1,limit:20};u(i)},[o.q,u]),V=r.useCallback(i=>{if(l&&o.q){const m=l.products.find(A=>A.id===i),F=l.products.findIndex(A=>A.id===i)+1;m&&(D.trackEcommerce("select_item",{currency:"VND",value:m.price,items:[{item_id:m.id,item_name:m.name,item_category:m.category,item_brand:m.brand,price:m.price,quantity:1,index:F}]}),D.track("search_result_click",{search_term:o.q,product_id:i,product_name:m.name,position:F,source:"search_page"}))}N(`/product/${i}`)},[N,l,o.q]),G=r.useCallback(i=>{R.success("Đã thêm sản phẩm vào giỏ hàng")},[]),K=r.useCallback(i=>{z(m=>{const F=new Set(m);return F.has(i)?(F.delete(i),R.success("Đã xóa khỏi danh sách yêu thích")):(F.add(i),R.success("Đã thêm vào danh sách yêu thích")),F})},[]),X=r.useCallback(i=>{const m={...o,page:i};u(m)},[o,u]),n=r.useCallback(i=>{q(i)},[]),y=r.useCallback(()=>{C(i=>!i)},[]),Y=()=>o.q?`Tìm kiếm "${o.q}" - Yapee Vietnam`:"Tìm kiếm sản phẩm - Yapee Vietnam",J=()=>o.q?`Tìm kiếm sản phẩm "${o.q}" trên Yapee Vietnam. Hàng ngàn sản phẩm chính hãng với giá tốt nhất.`:"Tìm kiếm và mua sắm hàng ngàn sản phẩm chính hãng trên Yapee Vietnam với giá tốt nhất.";return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx("title",{children:Y()}),e.jsx("meta",{name:"description",content:J()}),e.jsx("meta",{property:"og:title",content:Y()}),e.jsx("meta",{property:"og:description",content:J()}),e.jsx("meta",{property:"og:type",content:"website"}),o.q&&e.jsx("meta",{name:"keywords",content:`${o.q}, mua sắm online, yapee vietnam`})]}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-40",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>N("/"),className:"text-2xl font-bold text-primary hover:opacity-80 transition-opacity",children:"Yapee"}),e.jsx("div",{className:"flex-1 max-w-2xl",children:e.jsx(Oe,{onSearch:_,onFilterClick:()=>S(!0),placeholder:"Tìm kiếm sản phẩm, thương hiệu, danh mục...",showFilters:!1,autoFocus:!o.q})}),e.jsx("div",{className:"lg:hidden",children:e.jsxs(me,{open:P,onOpenChange:S,children:[e.jsx(he,{asChild:!0,children:e.jsxs(g,{variant:"outline",size:"sm",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Lọc"]})}),e.jsxs(xe,{side:"left",className:"w-80 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Bộ lọc tìm kiếm"}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>S(!1),children:e.jsx(Z,{className:"h-4 w-4"})})]}),l&&e.jsx(le,{filters:l.filters,currentQuery:o,onFiltersChange:u,onClearFilters:U,isMobile:!0})]})]})})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"hidden lg:block",children:l&&e.jsx(le,{filters:l.filters,currentQuery:o,onFiltersChange:u,onClearFilters:U})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(He,{searchResponse:l,isLoading:f,error:v,onAddToCart:G,onToggleWishlist:K,onProductClick:V,onPageChange:X,wishlistedItems:L,viewMode:M,onViewModeChange:n,showOptimizationInfo:h,onToggleOptimizationInfo:y})})]})})]})]})}export{rs as SearchPage,rs as default};
//# sourceMappingURL=SearchPage-Ce6lKC50.js.map
