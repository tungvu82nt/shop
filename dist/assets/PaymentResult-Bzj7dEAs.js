import{j as e}from"./ui-vendor-S1POobSh.js";import{k as C,u as S,r as h}from"./react-vendor-DrHQLvTy.js";import{c as m,d,B as c,a2 as p,i as T,j as I,$ as P,a as M}from"./index-B_z83aGI.js";import{p as E}from"./paymentService-C8Me4PBo.js";import{C as u}from"./circle-x-CvsfpNQ6.js";import{A as j}from"./arrow-left-Bup_IKS6.js";import{C as V}from"./circle-check-big-DJfGvp7v.js";import"./chart-vendor-Bfyd95vO.js";import"./supabase-vendor-C-7U-qZP.js";import"./form-vendor-CeA2iSy3.js";const X=()=>{const[n]=C(),a=S(),[t,y]=h.useState(null),[N,x]=h.useState(!0),[g,f]=h.useState(null);h.useEffect(()=>{(async()=>{try{x(!0),f(null);const s=n.get("method")||"vnpay",l=n.get("vnp_TxnRef")||n.get("orderId");if(!l)throw new Error("Không tìm thấy thông tin đơn hàng");const o=await E.verifyPayment(s,n);if(y(o),o.status==="success"&&l)try{const{error:i}=await P.from("orders").update({status:"paid",payment_status:"completed",payment_method:s,payment_transaction_id:o.transactionId,paid_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",l);i?console.error("Lỗi cập nhật trạng thái đơn hàng:",i):console.log("Cập nhật trạng thái đơn hàng thành công:",l)}catch(i){console.error("Lỗi khi cập nhật đơn hàng:",i)}}catch(s){console.error("Payment result processing error:",s),f(s instanceof Error?s.message:"Có lỗi xảy ra khi xử lý kết quả thanh toán")}finally{x(!1)}})()},[n]);const w=()=>{if(!t)return null;switch(t.status){case"success":return e.jsx(V,{className:"w-16 h-16 text-green-500 mx-auto mb-4"});case"failed":return e.jsx(u,{className:"w-16 h-16 text-red-500 mx-auto mb-4"});case"pending":return e.jsx(M,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"});case"cancelled":return e.jsx(u,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"});default:return null}},b=()=>{if(!t)return"Đang xử lý...";switch(t.status){case"success":return"Thanh toán thành công!";case"failed":return"Thanh toán thất bại";case"pending":return"Thanh toán đang xử lý";case"cancelled":return"Thanh toán đã bị hủy";default:return"Trạng thái không xác định"}},v=()=>{if(!t)return"Vui lòng đợi trong giây lát...";switch(t.status){case"success":return"Đơn hàng của bạn đã được thanh toán thành công. Chúng tôi sẽ xử lý và giao hàng trong thời gian sớm nhất.";case"failed":return"Thanh toán không thành công. Vui lòng thử lại hoặc chọn phương thức thanh toán khác.";case"pending":return"Thanh toán đang được xử lý. Chúng tôi sẽ thông báo kết quả qua email khi hoàn tất.";case"cancelled":return"Bạn đã hủy thanh toán. Đơn hàng vẫn được lưu và bạn có thể thanh toán lại bất cứ lúc nào.";default:return"Không thể xác định trạng thái thanh toán."}},k=()=>{if(!t)return null;const r=[];return t.status==="success"&&r.push(e.jsx(c,{onClick:()=>a(`/order-success?orderId=${t.orderId}`),className:"w-full sm:w-auto",children:"Xem chi tiết đơn hàng"},"view-order")),(t.status==="failed"||t.status==="cancelled")&&r.push(e.jsxs(c,{onClick:()=>a("/checkout"),variant:"outline",className:"w-full sm:w-auto",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Thử lại thanh toán"]},"retry-payment")),r.push(e.jsxs(c,{onClick:()=>a("/"),variant:t.status==="success"?"outline":"default",className:"w-full sm:w-auto",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Về trang chủ"]},"home")),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center mt-6",children:r})};return N?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsx(m,{className:"w-full max-w-md",children:e.jsxs(d,{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Đang xử lý kết quả thanh toán"}),e.jsx("p",{className:"text-gray-600",children:"Vui lòng đợi trong giây lát..."})]})})}):g?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsx(m,{className:"w-full max-w-md",children:e.jsxs(d,{className:"p-8 text-center",children:[e.jsx(u,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2 text-red-600",children:"Có lỗi xảy ra"}),e.jsx("p",{className:"text-gray-600 mb-6",children:g}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(c,{onClick:()=>a("/checkout"),variant:"outline",className:"w-full sm:w-auto",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Quay lại thanh toán"]}),e.jsxs(c,{onClick:()=>a("/"),className:"w-full sm:w-auto",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Về trang chủ"]})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs(m,{className:"w-full max-w-md",children:[e.jsx(T,{children:e.jsxs(I,{className:"text-center",children:[w(),e.jsx("h1",{className:"text-2xl font-bold",children:b()})]})}),e.jsxs(d,{className:"p-6",children:[e.jsx("p",{className:"text-gray-600 text-center mb-6",children:v()}),t&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Mã đơn hàng:"}),e.jsx("span",{className:"font-medium",children:t.orderId})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Số tiền:"}),e.jsxs("span",{className:"font-medium",children:[t.amount.toLocaleString("vi-VN")," ₫"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Phương thức:"}),e.jsxs("span",{className:"font-medium capitalize",children:[t.paymentMethod==="vnpay"&&"VNPay",t.paymentMethod==="momo"&&"MoMo",t.paymentMethod==="cod"&&"Thanh toán khi nhận hàng",t.paymentMethod==="bank_transfer"&&"Chuyển khoản ngân hàng"]})]}),t.transactionId&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Mã giao dịch:"}),e.jsx("span",{className:"font-medium",children:t.transactionId})]}),t.paidAt&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Thời gian:"}),e.jsx("span",{className:"font-medium",children:new Date(t.paidAt).toLocaleString("vi-VN")})]})]}),k()]})]})})};export{X as default};
//# sourceMappingURL=PaymentResult-Bzj7dEAs.js.map
