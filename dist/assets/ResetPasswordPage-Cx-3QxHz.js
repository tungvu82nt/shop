import{j as e}from"./ui-vendor-S1POobSh.js";import{u as z,k as G,r as a}from"./react-vendor-DrHQLvTy.js";import{c as E,i as f,a6 as V,j as p,k as j,d as w,O as b,Q as N,B as m,ao as y,l as L,I,a8 as M,a7 as A,m as k}from"./index-B_z83aGI.js";import{P as J}from"./progress-lxZ0-YvS.js";import{A as K}from"./AuthLayout-DxpTxSLH.js";import{s as D,a as U}from"./authService-guulQlN8.js";import{C as F}from"./circle-check-big-DJfGvp7v.js";import"./chart-vendor-Bfyd95vO.js";import"./supabase-vendor-C-7U-qZP.js";import"./form-vendor-CeA2iSy3.js";import"./shield-CnI5vR7_.js";import"./users-B4TySy3P.js";import"./arrow-left-Bup_IKS6.js";const de=()=>{const i=z(),[v]=G(),c=v.get("token"),h=v.get("email"),[r,B]=a.useState({password:"",confirmPassword:""}),[n,d]=a.useState({}),[x,O]=a.useState(!1),[u,$]=a.useState(!1),[l,P]=a.useState(!1),[R,Q]=a.useState(!1),[S,g]=a.useState(null),[o,C]=a.useState({score:0,feedback:[],isStrong:!1});a.useEffect(()=>{if(!c){g(!1);return}if(c.length<20){g(!1);return}g(!0)},[c]),a.useEffect(()=>{Object.keys(n).length>0&&d({})},[r]),a.useEffect(()=>{if(r.password){const s=D.checkPasswordStrength(r.password);C(s)}else C({score:0,feedback:[],isStrong:!1})},[r.password]);const Y=()=>{const s={};if(!r.password)s.password="Vui lòng nhập mật khẩu mới";else{const t=D.validatePassword(r.password);t.isValid||(s.password=t.errors[0])}return r.confirmPassword?r.password!==r.confirmPassword&&(s.confirmPassword="Mật khẩu xác nhận không khớp"):s.confirmPassword="Vui lòng xác nhận mật khẩu",d(s),Object.keys(s).length===0},H=async s=>{if(s.preventDefault(),!(!Y()||!c)){P(!0);try{const t=await U.updatePassword(r.password,c);if(t.error){d({general:t.error}),k.error(t.error);return}Q(!0),k.success("Mật khẩu đã được cập nhật thành công!"),setTimeout(()=>{i("/login",{state:{message:"Mật khẩu đã được đặt lại thành công. Vui lòng đăng nhập với mật khẩu mới.",email:h}})},3e3)}catch(t){console.error("Reset password error:",t),k.error("Đã xảy ra lỗi. Vui lòng thử lại."),d({general:"Đã xảy ra lỗi hệ thống"})}finally{P(!1)}}},T=s=>t=>{B(q=>({...q,[s]:t.target.value}))},X=()=>o.score<=2?"Yếu":o.score<=4?"Trung bình":"Mạnh";return S===!1?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-red-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs(E,{className:"shadow-xl border-0",children:[e.jsxs(f,{className:"text-center pb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(V,{className:"w-8 h-8 text-red-600"})}),e.jsx(p,{className:"text-2xl font-bold text-gray-800",children:"Liên kết không hợp lệ"}),e.jsx(j,{className:"text-gray-600",children:"Liên kết đặt lại mật khẩu không hợp lệ hoặc đã hết hạn"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs(b,{variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(N,{children:"Liên kết này có thể đã hết hạn hoặc đã được sử dụng. Vui lòng yêu cầu liên kết mới."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{onClick:()=>i("/forgot-password"),className:"w-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600",children:"Yêu cầu liên kết mới"}),e.jsx(m,{variant:"outline",onClick:()=>i("/login"),className:"w-full",children:"Quay lại đăng nhập"})]})]})]})})}):S===null?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-red-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Đang xác thực liên kết..."})]})}):R?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-red-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs(E,{className:"shadow-xl border-0",children:[e.jsxs(f,{className:"text-center pb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(F,{className:"w-8 h-8 text-green-600"})}),e.jsx(p,{className:"text-2xl font-bold text-gray-800",children:"Thành công!"}),e.jsx(j,{className:"text-gray-600",children:"Mật khẩu của bạn đã được đặt lại thành công"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs(b,{className:"border-green-200 bg-green-50",children:[e.jsx(F,{className:"h-4 w-4 text-green-600"}),e.jsx(N,{className:"text-green-800",children:"Bạn sẽ được chuyển đến trang đăng nhập trong giây lát..."})]}),e.jsx(m,{onClick:()=>i("/login"),className:"w-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600",children:"Đăng nhập ngay"})]})]})})}):e.jsxs(K,{title:"Tạo mật khẩu mới",subtitle:"Đặt lại mật khẩu để bảo vệ tài khoản của bạn",children:[e.jsxs(f,{className:"text-center pb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center mb-4",children:e.jsx(y,{className:"w-8 h-8 text-white"})}),e.jsx(p,{className:"text-2xl font-bold text-gray-800",children:"Đặt lại mật khẩu"}),e.jsx(j,{className:"text-gray-600",children:h?`Tạo mật khẩu mới cho ${h}`:"Tạo mật khẩu mới cho tài khoản của bạn"})]}),e.jsxs(w,{className:"space-y-6",children:[n.general&&e.jsx(b,{variant:"destructive",children:e.jsx(N,{children:n.general})}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"password",className:"text-gray-700 font-medium",children:"Mật khẩu mới *"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(I,{id:"password",type:x?"text":"password",placeholder:"Nhập mật khẩu mới",value:r.password,onChange:T("password"),className:`pl-10 pr-10 h-12 ${n.password?"border-red-300 focus:border-red-500":""}`,disabled:l,autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>O(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:l,children:x?e.jsx(M,{className:"w-4 h-4"}):e.jsx(A,{className:"w-4 h-4"})})]}),r.password&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Độ mạnh mật khẩu:"}),e.jsx("span",{className:`text-sm font-medium ${o.score<=2?"text-red-500":o.score<=4?"text-yellow-500":"text-green-500"}`,children:X()})]}),e.jsx(J,{value:o.score/6*100,className:"h-2"}),o.feedback.length>0&&e.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:o.feedback.map((s,t)=>e.jsxs("li",{children:["• ",s]},t))})]}),n.password&&e.jsx("p",{className:"text-red-500 text-sm",children:n.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"confirmPassword",className:"text-gray-700 font-medium",children:"Xác nhận mật khẩu *"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(I,{id:"confirmPassword",type:u?"text":"password",placeholder:"Nhập lại mật khẩu mới",value:r.confirmPassword,onChange:T("confirmPassword"),className:`pl-10 pr-10 h-12 ${n.confirmPassword?"border-red-300 focus:border-red-500":""}`,disabled:l}),e.jsx("button",{type:"button",onClick:()=>$(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:l,children:u?e.jsx(M,{className:"w-4 h-4"}):e.jsx(A,{className:"w-4 h-4"})})]}),n.confirmPassword&&e.jsx("p",{className:"text-red-500 text-sm",children:n.confirmPassword})]}),e.jsx(m,{type:"submit",className:"w-full h-12 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-semibold",disabled:l||!o.isStrong,children:l?"Đang cập nhật...":"Đặt lại mật khẩu"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-blue-800 text-sm",children:[e.jsx("strong",{children:"Lưu ý bảo mật:"})," Sau khi đặt lại mật khẩu, bạn sẽ cần đăng nhập lại trên tất cả thiết bị."]})})]})]})};export{de as default};
//# sourceMappingURL=ResetPasswordPage-Cx-3QxHz.js.map
