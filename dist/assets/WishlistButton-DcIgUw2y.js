var M=Object.defineProperty;var K=(i,t,e)=>t in i?M(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var f=(i,t,e)=>K(i,typeof t!="symbol"?t+"":t,e);import{j as n,H as E,J as O,K as W,M as V}from"./ui-vendor-S1POobSh.js";import{r as g}from"./react-vendor-DrHQLvTy.js";import{G as x,m as d,B as A,b as _,h as B}from"./index-B_z83aGI.js";const X=({src:i,alt:t,width:e,height:r,className:s,placeholderSrc:a="/placeholder.svg",lazyLoad:h=!0,onLoad:o,onError:c,...l})=>{const[y,S]=g.useState(!1),[I,L]=g.useState(!1),m=g.useRef(null),b=g.useRef(null);g.useEffect(()=>{if(S(!1),L(!1),!h)return;const D=new IntersectionObserver(C=>{C.forEach(N=>{N.isIntersecting&&m.current&&(m.current.src=i,D.unobserve(N.target))})},{rootMargin:"200px",threshold:.01});return m.current&&D.observe(m.current),b.current=D,()=>{b.current&&b.current.disconnect()}},[i,h]);const k=()=>{S(!0),o==null||o()},w=()=>{L(!0),c==null||c()};return n.jsxs("div",{className:x("relative overflow-hidden bg-gray-100",s),style:{width:e,height:r},children:[n.jsx("img",{ref:m,src:h?a:i,alt:t,width:e,height:r,onLoad:k,onError:w,className:x("w-full h-full object-cover transition-opacity duration-300",y?"opacity-100":"opacity-0",I?"hidden":"block"),...l}),(!y||I)&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:I?n.jsxs("div",{className:"text-gray-400 text-sm",children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"mx-auto mb-1",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("polyline",{points:"21 15 16 10 5 21"})]}),n.jsx("span",{children:"Không thể tải ảnh"})]}):n.jsx("img",{src:a,alt:"Loading",className:"w-full h-full object-cover"})})]})},R=O,P=W,F=V,$=g.forwardRef(({className:i,sideOffset:t=4,...e},r)=>n.jsx(E,{ref:r,sideOffset:t,className:x("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...e}));$.displayName=E.displayName;const v={duration:{success:3e3,error:5e3,warning:4e3,info:3e3,loading:0},position:"top-right",richColors:!0,closeButton:!0};class z{constructor(){f(this,"crud",{created:t=>this.success(`${t} đã được tạo thành công`),updated:t=>this.success(`${t} đã được cập nhật thành công`),deleted:t=>this.success(`${t} đã được xóa thành công`),createError:(t,e)=>this.error(`Không thể tạo ${t}`,{description:e||"Vui lòng thử lại sau"}),updateError:(t,e)=>this.error(`Không thể cập nhật ${t}`,{description:e||"Vui lòng thử lại sau"}),deleteError:(t,e)=>this.error(`Không thể xóa ${t}`,{description:e||"Vui lòng thử lại sau"})});f(this,"auth",{loginSuccess:t=>this.success(t?`Chào mừng ${t}!`:"Đăng nhập thành công"),logoutSuccess:()=>this.info("Đã đăng xuất thành công"),registerSuccess:()=>this.success("Đăng ký tài khoản thành công"),loginError:t=>this.error("Đăng nhập thất bại",{description:t||"Vui lòng kiểm tra thông tin đăng nhập"}),registerError:t=>this.error("Đăng ký thất bại",{description:t||"Vui lòng thử lại sau"}),loginRequired:()=>this.warning("Vui lòng đăng nhập để tiếp tục"),accessDenied:()=>this.error("Bạn không có quyền truy cập tính năng này")});f(this,"cart",{added:t=>this.success(`Đã thêm ${t} vào giỏ hàng`),removed:t=>this.info(`Đã xóa ${t} khỏi giỏ hàng`),updated:t=>this.info(`Đã cập nhật số lượng ${t}`),empty:()=>this.warning("Giỏ hàng của bạn đang trống"),outOfStock:t=>this.warning(`${t} hiện đã hết hàng`)});f(this,"order",{placed:t=>this.success("Đặt hàng thành công",{description:`Mã đơn hàng: ${t}`}),cancelled:t=>this.info("Đơn hàng đã được hủy",{description:`Mã đơn hàng: ${t}`}),paymentSuccess:()=>this.success("Thanh toán thành công"),paymentFailed:t=>this.error("Thanh toán thất bại",{description:t||"Vui lòng thử lại sau"})})}success(t,e){return d.success(t,{description:e==null?void 0:e.description,duration:(e==null?void 0:e.duration)??v.duration.success,action:e==null?void 0:e.action,onDismiss:e==null?void 0:e.onDismiss,onAutoClose:e==null?void 0:e.onAutoClose})}error(t,e){return d.error(t,{description:e==null?void 0:e.description,duration:(e==null?void 0:e.duration)??v.duration.error,action:e==null?void 0:e.action,onDismiss:e==null?void 0:e.onDismiss,onAutoClose:e==null?void 0:e.onAutoClose})}warning(t,e){return d.warning(t,{description:e==null?void 0:e.description,duration:(e==null?void 0:e.duration)??v.duration.warning,action:e==null?void 0:e.action,onDismiss:e==null?void 0:e.onDismiss,onAutoClose:e==null?void 0:e.onAutoClose})}info(t,e){return d.info(t,{description:e==null?void 0:e.description,duration:(e==null?void 0:e.duration)??v.duration.info,action:e==null?void 0:e.action,onDismiss:e==null?void 0:e.onDismiss,onAutoClose:e==null?void 0:e.onAutoClose})}loading(t,e){return d.loading(t,{description:e==null?void 0:e.description})}promise(t,e){var r,s;return d.promise(t,{loading:e.loading,success:a=>typeof e.success=="function"?e.success(a):e.success,error:a=>typeof e.error=="function"?e.error(a):e.error,description:e.description,duration:{success:((r=e.duration)==null?void 0:r.success)??v.duration.success,error:((s=e.duration)==null?void 0:s.error)??v.duration.error}})}update(t,e,r,s){const a={description:s==null?void 0:s.description,duration:(s==null?void 0:s.duration)??v.duration[e],action:s==null?void 0:s.action,onDismiss:s==null?void 0:s.onDismiss,onAutoClose:s==null?void 0:s.onAutoClose};switch(e){case"success":d.success(r,{...a,id:t});break;case"error":d.error(r,{...a,id:t});break;case"warning":d.warning(r,{...a,id:t});break;case"info":d.info(r,{...a,id:t});break;case"loading":d.loading(r,{description:a.description,id:t});break}}dismiss(t){d.dismiss(t)}dismissAll(){d.dismiss()}}const u=new z,T={storageKey:"yapee_wishlist",maxItems:100,syncInterval:5e3};class J{constructor(){f(this,"wishlistData");f(this,"listeners",new Set);f(this,"syncTimer",null);this.wishlistData=this.loadFromStorage(),this.startSync()}loadFromStorage(){var t;try{const e=localStorage.getItem(T.storageKey);if(e){const r=JSON.parse(e);return{...r,items:r.items||[],totalItems:((t=r.items)==null?void 0:t.length)||0}}}catch(e){console.error("Lỗi khi tải wishlist từ localStorage:",e)}return{items:[],lastUpdated:new Date().toISOString(),totalItems:0}}saveToStorage(){try{this.wishlistData.lastUpdated=new Date().toISOString(),this.wishlistData.totalItems=this.wishlistData.items.length,localStorage.setItem(T.storageKey,JSON.stringify(this.wishlistData))}catch(t){console.error("Lỗi khi lưu wishlist vào localStorage:",t)}}notifyListeners(){this.listeners.forEach(t=>{try{t(this.wishlistData)}catch(e){console.error("Lỗi khi thông báo wishlist listener:",e)}})}startSync(){this.syncTimer&&clearInterval(this.syncTimer),this.syncTimer=setInterval(()=>{this.saveToStorage()},T.syncInterval)}stopSync(){this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)}subscribe(t){return this.listeners.add(t),t(this.wishlistData),()=>{this.listeners.delete(t)}}getWishlist(){return{...this.wishlistData}}getItems(t){let e=[...this.wishlistData.items];return t&&(t.category&&(e=e.filter(r=>{var s;return(s=r.product.category)==null?void 0:s.toLowerCase().includes(t.category.toLowerCase())})),t.brand&&(e=e.filter(r=>{var s;return(s=r.product.brand)==null?void 0:s.toLowerCase().includes(t.brand.toLowerCase())})),t.minPrice!==void 0&&(e=e.filter(r=>r.product.price>=t.minPrice)),t.maxPrice!==void 0&&(e=e.filter(r=>r.product.price<=t.maxPrice)),t.inStock!==void 0&&(e=e.filter(r=>r.product.inStock===t.inStock)),t.sortBy&&e.sort((r,s)=>{let a,h;switch(t.sortBy){case"addedAt":a=new Date(r.addedAt).getTime(),h=new Date(s.addedAt).getTime();break;case"price":a=r.product.price,h=s.product.price;break;case"name":a=r.product.name.toLowerCase(),h=s.product.name.toLowerCase();break;case"rating":a=r.product.rating||0,h=s.product.rating||0;break;default:return 0}return t.sortOrder==="desc"?h>a?1:h<a?-1:0:a>h?1:a<h?-1:0})),e}isInWishlist(t){return this.wishlistData.items.some(e=>e.productId===t)}getItem(t){return this.wishlistData.items.find(e=>e.productId===t)||null}addItem(t,e){try{if(this.isInWishlist(t.id))return u.warning(`${t.name} đã có trong danh sách yêu thích`),!1;if(this.wishlistData.items.length>=T.maxItems)return u.error("Danh sách yêu thích đã đầy",{description:`Tối đa ${T.maxItems} sản phẩm`}),!1;const r={productId:t.id,product:t,addedAt:new Date().toISOString(),notes:e};return this.wishlistData.items.unshift(r),this.saveToStorage(),this.notifyListeners(),u.success(`Đã thêm ${t.name} vào danh sách yêu thích`),!0}catch(r){return console.error("Lỗi khi thêm vào wishlist:",r),u.error("Không thể thêm vào danh sách yêu thích"),!1}}removeItem(t){try{const e=this.wishlistData.items.findIndex(s=>s.productId===t);if(e===-1)return u.warning("Sản phẩm không có trong danh sách yêu thích"),!1;const r=this.wishlistData.items[e];return this.wishlistData.items.splice(e,1),this.saveToStorage(),this.notifyListeners(),u.info(`Đã xóa ${r.product.name} khỏi danh sách yêu thích`),!0}catch(e){return console.error("Lỗi khi xóa khỏi wishlist:",e),u.error("Không thể xóa khỏi danh sách yêu thích"),!1}}toggleItem(t,e){return this.isInWishlist(t.id)?this.removeItem(t.id):this.addItem(t,e)}updateNotes(t,e){try{const r=this.wishlistData.items.find(s=>s.productId===t);return r?(r.notes=e,this.saveToStorage(),this.notifyListeners(),u.success("Đã cập nhật ghi chú"),!0):(u.warning("Sản phẩm không có trong danh sách yêu thích"),!1)}catch(r){return console.error("Lỗi khi cập nhật ghi chú:",r),u.error("Không thể cập nhật ghi chú"),!1}}clearAll(){try{return this.wishlistData.items=[],this.saveToStorage(),this.notifyListeners(),u.info("Đã xóa toàn bộ danh sách yêu thích"),!0}catch(t){return console.error("Lỗi khi xóa toàn bộ wishlist:",t),u.error("Không thể xóa danh sách yêu thích"),!1}}getStats(){const t=this.wishlistData.items,e=t.length,r=t.reduce((c,l)=>c+l.product.price,0),s=e>0?r/e:0,a={};t.forEach(c=>{const l=c.product.category||"Khác";a[l]=(a[l]||0)+1});const h={};t.forEach(c=>{const l=c.product.brand||"Khác";h[l]=(h[l]||0)+1});const o={under1M:0,from1Mto5M:0,from5Mto10M:0,over10M:0};return t.forEach(c=>{const l=c.product.price;l<1e6?o.under1M++:l<5e6?o.from1Mto5M++:l<1e7?o.from5Mto10M++:o.over10M++}),{totalItems:e,totalValue:r,averagePrice:s,categoriesCount:a,brandsCount:h,priceRanges:o}}exportData(){return JSON.stringify(this.wishlistData,null,2)}importData(t){try{const e=JSON.parse(t);if(!e.items||!Array.isArray(e.items))throw new Error("Dữ liệu không hợp lệ");return this.wishlistData={...e,totalItems:e.items.length,lastUpdated:new Date().toISOString()},this.saveToStorage(),this.notifyListeners(),u.success("Đã import danh sách yêu thích thành công"),!0}catch(e){return console.error("Lỗi khi import wishlist:",e),u.error("Không thể import danh sách yêu thích"),!1}}destroy(){this.stopSync(),this.saveToStorage(),this.listeners.clear()}}const j=new J;typeof window<"u"&&window.addEventListener("beforeunload",()=>{j.destroy()});function Y({product:i,variant:t="ghost",size:e="md",showTooltip:r=!0,className:s,iconOnly:a=!1,notes:h,onToggle:o}){const[c,l]=g.useState(!1),[y,S]=g.useState(!1);g.useEffect(()=>j.subscribe(w=>{l(j.isInWishlist(i.id))}),[i.id]);const I=async k=>{if(k.preventDefault(),k.stopPropagation(),!y){S(!0);try{const w=c,D=j.toggleItem(i,h),C=j.isInWishlist(i.id);D&&(C&&!w?(_.trackEcommerce("add_to_wishlist",{currency:"VND",value:i.price,items:[{item_id:i.id.toString(),item_name:i.name,item_category:i.category,item_brand:i.brand,price:i.price,quantity:1}]}),_.track("wishlist_add",{product_id:i.id,product_name:i.name,product_category:i.category,product_price:i.price,notes:h||""})):!C&&w&&(_.trackEcommerce("remove_from_wishlist",{currency:"VND",value:i.price,items:[{item_id:i.id.toString(),item_name:i.name,item_category:i.category,item_brand:i.brand,price:i.price,quantity:1}]}),_.track("wishlist_remove",{product_id:i.id,product_name:i.name,product_category:i.category,product_price:i.price})),o&&o(C))}catch(w){console.error("Lỗi khi toggle wishlist:",w)}finally{S(!1)}}},L=()=>{switch(e){case"sm":return"h-4 w-4";case"lg":return"h-6 w-6";default:return"h-5 w-5"}},m=()=>{switch(e){case"sm":return"sm";case"lg":return"lg";default:return"default"}},b=()=>n.jsxs(n.Fragment,{children:[n.jsx(B,{className:x(L(),"transition-all duration-200",c?"fill-red-500 text-red-500 scale-110":"text-gray-400 hover:text-red-500",y&&"animate-pulse")}),!a&&n.jsx("span",{className:x("ml-2 transition-colors duration-200",c?"text-red-500":"text-gray-600"),children:c?"Đã thích":"Yêu thích"})]});return r?n.jsx(R,{children:n.jsxs(P,{children:[n.jsx(F,{asChild:!0,children:n.jsx(A,{variant:t,size:m(),onClick:I,disabled:y,className:x("transition-all duration-200",c&&t==="ghost"&&"bg-red-50 hover:bg-red-100",a&&"p-2",s),"aria-label":c?"Xóa khỏi danh sách yêu thích":"Thêm vào danh sách yêu thích",children:b()})}),n.jsx($,{children:n.jsx("p",{children:c?"Xóa khỏi danh sách yêu thích":"Thêm vào danh sách yêu thích"})})]})}):n.jsx(A,{variant:t,size:m(),onClick:I,disabled:y,className:x("transition-all duration-200",c&&t==="ghost"&&"bg-red-50 hover:bg-red-100",a&&"p-2",s),"aria-label":c?"Xóa khỏi danh sách yêu thích":"Thêm vào danh sách yêu thích",children:b()})}export{X as O,Y as W,u as n,j as w};
//# sourceMappingURL=WishlistButton-DcIgUw2y.js.map
