{"version":3,"file":"LoginPage-BwTYTkVg.js","sources":["../../src/pages/auth/LoginPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { Link, useNavigate } from 'react-router-dom'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport * as z from 'zod'\nimport { Eye, EyeOff, Mail, Lock } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { toast } from 'sonner'\nimport AuthLayout from '@/components/layout/AuthLayout'\nimport { analytics } from '@/lib/analytics'\n\nconst loginSchema = z.object({\n  email: z.string().email('Email không hợp lệ'),\n  password: z.string().min(6, 'Mật khẩu phải có ít nhất 6 ký tự'),\n})\n\ntype LoginFormData = z.infer<typeof loginSchema>\n\nexport default function LoginPage() {\n  const [showPassword, setShowPassword] = useState(false)\n  const [isLoading, setIsLoading] = useState(false)\n  const [loginSuccess, setLoginSuccess] = useState(false)\n  const { signIn, userProfile, user } = useAuth()\n  const navigate = useNavigate()\n\n  // Theo dõi thay đổi userProfile sau khi đăng nhập thành công\n  useEffect(() => {\n    if (loginSuccess && userProfile && user) {\n      // Kiểm tra role và chuyển hướng phù hợp\n      if (userProfile.role === 'admin') {\n        navigate('/admin')\n      } else {\n        navigate('/')\n      }\n      setLoginSuccess(false) // Reset trạng thái\n    }\n  }, [loginSuccess, userProfile, user, navigate])\n\n  const {\n    register,\n    handleSubmit,\n    formState: { errors },\n  } = useForm<LoginFormData>({\n    resolver: zodResolver(loginSchema),\n  })\n\n  const onSubmit = async (data: LoginFormData) => {\n    setIsLoading(true)\n    try {\n      const result = await signIn(data.email, data.password)\n      if (result.error) {\n        toast.error(result.error.message || 'Đăng nhập thất bại')\n        \n        // Theo dõi đăng nhập thất bại\n        analytics.trackAuth('login_failed', {\n          method: 'email',\n          error: result.error.message || 'Login failed'\n        });\n        \n        return\n      }\n      \n      toast.success('Đăng nhập thành công!')\n      \n      // Theo dõi đăng nhập thành công\n      analytics.trackAuth('login', {\n        method: 'email',\n        user_id: result.user?.id\n      });\n      \n      setLoginSuccess(true) // Đánh dấu đăng nhập thành công để useEffect xử lý chuyển hướng\n      \n    } catch (error: any) {\n      toast.error(error.message || 'Đăng nhập thất bại')\n      \n      // Theo dõi lỗi đăng nhập\n      analytics.trackAuth('login_failed', {\n        method: 'email',\n        error: error.message || 'Unknown error'\n      });\n      \n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <AuthLayout\n      title=\"Chào mừng trở lại\"\n      subtitle=\"Đăng nhập vào tài khoản của bạn\"\n    >\n      <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"email\">Email</Label>\n          <div className=\"relative\">\n            <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n            <Input\n              id=\"email\"\n              type=\"email\"\n              placeholder=\"Nhập email của bạn\"\n              className=\"pl-10\"\n              {...register('email')}\n            />\n          </div>\n          {errors.email && (\n            <p className=\"text-sm text-red-600\">{errors.email.message}</p>\n          )}\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"password\">Mật khẩu</Label>\n          <div className=\"relative\">\n            <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n            <Input\n              id=\"password\"\n              type={showPassword ? 'text' : 'password'}\n              placeholder=\"Nhập mật khẩu\"\n              className=\"pl-10 pr-10\"\n              {...register('password')}\n            />\n            <button\n              type=\"button\"\n              onClick={() => setShowPassword(!showPassword)}\n              className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\n            >\n              {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n            </button>\n          </div>\n          {errors.password && (\n            <p className=\"text-sm text-red-600\">{errors.password.message}</p>\n          )}\n        </div>\n\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-2\">\n            <input\n              id=\"remember\"\n              type=\"checkbox\"\n              className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n            />\n            <Label htmlFor=\"remember\" className=\"text-sm\">\n              Ghi nhớ đăng nhập\n            </Label>\n          </div>\n          <Link\n            to=\"/forgot-password\"\n            className=\"text-sm text-blue-600 hover:text-blue-500\"\n          >\n            Quên mật khẩu?\n          </Link>\n        </div>\n\n        <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n          {isLoading ? 'Đang đăng nhập...' : 'Đăng nhập'}\n        </Button>\n\n        <div className=\"text-center\">\n          <span className=\"text-sm text-gray-600\">\n            Chưa có tài khoản?{' '}\n            <Link to=\"/register\" className=\"text-blue-600 hover:text-blue-500 font-medium\">\n              Đăng ký ngay\n            </Link>\n          </span>\n        </div>\n      </form>\n    </AuthLayout>\n  )\n}"],"names":["loginSchema","z.object","z.string","LoginPage","showPassword","setShowPassword","useState","isLoading","setIsLoading","loginSuccess","setLoginSuccess","signIn","userProfile","user","useAuth","navigate","useNavigate","useEffect","register","handleSubmit","errors","useForm","zodResolver","onSubmit","data","result","toast","analytics","_a","error","jsx","AuthLayout","jsxs","Label","Mail","Input","Lock","EyeOff","Eye","Link","Button"],"mappings":"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"}